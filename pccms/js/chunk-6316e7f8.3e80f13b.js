(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6316e7f8"],{"0b8e":function(e,t,i){"use strict";var n=i("222e");i.n(n).a},1:function(e,t){},2:function(e,t){},"222e":function(e,t,i){},"2f0c":function(e,t,i){"use strict";var n=i("7361");i.n(n).a},"333d":function(e,t,i){"use strict";var n={name:"Pagination",props:{small:{type:Boolean,default:!1},total:{required:!0,type:Number},page:{type:Number,default:1},background:{type:Boolean,default:!0},layout:{type:String,default:"prev, pager, next"},pageSize:{type:Number,default:10}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}}},methods:{handleClickPage:function(e){this.$emit("pagination",e)}}},a=(i("2f0c"),i("2877")),r=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{small:e.small,background:e.background,total:e.total,layout:e.layout,"page-size":e.pageSize,"current-page":e.currentPage},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handleClickPage}})],1)}),[],!1,null,null,null);t.a=r.exports},"412c":function(e,t,i){"use strict";var n=i("9cef");i.n(n).a},"42a0":function(e,t,i){"use strict";i.r(t);var n=i("a34a"),a=i.n(n),r=i("365c");function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l={props:{visible:{type:Boolean},editData:Object,canteenList:Array,c_id:[String,Number]},data:function(){return{value:"",c_list:[],hideUpload:!1,formdata:{f_type:1,canteen_id:"",dinner_id:"",m_id:"",name:"",price:"",des:"",chef:"",img_url:""},categoryList:[],dinnerList:[],rules:{},isOpen:this.visible,dialogVisible:!1,dialogImageUrl:"",limit:1}},watch:{visible:function(e){this.isOpen=e}},methods:{_add:function(){var e=this;this.formdata=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(i,!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({c_id:this.c_id},this.formdata),r.a.post("/v1/food/save",this.formdata).then((function(t){e.$refs.addUpload.clearFiles(),e.handleClose()})).catch((function(e){return console.log(e)}))},getDinnersList:function(e){var t=this;this.formdata.dinner_id="",this.formdata.m_id="",r.a.get("/v1/canteen/dinners?canteen_id=".concat(e)).then((function(e){t.dinnerList=Array.from(e.data)})).catch((function(e){return console.log(e)}))},getCategoryList:function(e){var t=this;r.a.get("/v1/menus/dinner?dinner_id=".concat(e)).then((function(e){return t.categoryList=Array.from(e.data)})).catch((function(e){return console.log(e)}))},handleClose:function(){this.$refs.cuisineManageForm.resetFields(),this.$refs.addUpload.clearFiles(),this.hideUpload=!1,this.$emit("closeDialog",!1)},handleChange:function(e,t){this.hideUpload=t.length>=this.limit},handleRemove:function(e,t){this.hideUpload=t.length>=this.limit},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleSuccess:function(e,t,i){this.hideUpload=i.length>=this.limit,this.formdata.img_url=e.data.url}}},c=(i("0b8e"),i("2877")),d=Object(c.a)(l,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"diaForm",attrs:{title:"菜品管理",visible:e.isOpen,width:"40%"},on:{"update:visible":function(t){e.isOpen=t},close:e.handleClose}},[i("el-form",{ref:"cuisineManageForm",attrs:{model:e.formdata,rules:e.rules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"饭堂名称",prop:"canteen_id"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},on:{change:e.getDinnersList},model:{value:e.formdata.canteen_id,callback:function(t){e.$set(e.formdata,"canteen_id",t)},expression:"formdata.canteen_id"}},e._l(e.canteenList,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:"餐次",prop:"dinner_id"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},on:{change:e.getCategoryList},model:{value:e.formdata.dinner_id,callback:function(t){e.$set(e.formdata,"dinner_id",t)},expression:"formdata.dinner_id"}},e._l(e.dinnerList,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:"类型",prop:"m_id"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},model:{value:e.formdata.m_id,callback:function(t){e.$set(e.formdata,"m_id",t)},expression:"formdata.m_id"}},e._l(e.categoryList,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:"菜品名称",prop:"name"}},[i("el-input",{attrs:{type:"text"},model:{value:e.formdata.name,callback:function(t){e.$set(e.formdata,"name",t)},expression:"formdata.name"}})],1),i("el-form-item",{attrs:{label:"菜品单价",prop:"price"}},[i("el-input",{attrs:{type:"text"},model:{value:e.formdata.price,callback:function(t){e.$set(e.formdata,"price",t)},expression:"formdata.price"}})],1),i("el-form-item",{attrs:{label:"主厨名称",prop:"chef"}},[i("el-input",{attrs:{type:"text"},model:{value:e.formdata.chef,callback:function(t){e.$set(e.formdata,"chef",t)},expression:"formdata.chef"}})],1),i("el-form-item",{attrs:{label:"菜品描述",prop:"des"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.formdata.des,callback:function(t){e.$set(e.formdata,"des",t)},expression:"formdata.des"}})],1),i("el-form-item",{attrs:{label:"图片",prop:"img_url"}},[i("div",{staticClass:"imgs"},[i("el-upload",{ref:"addUpload",class:{hide:e.hideUpload},attrs:{action:"http://canteen.tonglingok.com/api/v1/image/upload","list-type":"picture-card",name:"image",limit:e.limit,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-change":e.handleChange,"on-success":e.handleSuccess}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e._add}},[e._v("确 定")])],1)],1)}),[],!1,null,"6c8cc46c",null).exports,u=i("333d"),m=i("575f"),p=(i("9490"),i("4360"));function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(i,!0).forEach((function(t){g(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function b(e,t,i,n,a,r,o){try{var s=e[r](o),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function y(e){return function(){var t=this,i=arguments;return new Promise((function(n,a){var r=e.apply(t,i);function o(e){b(r,n,a,o,s,"next",e)}function s(e){b(r,n,a,o,s,"throw",e)}o(void 0)}))}}var v,_,L,F={data:function(){return{grade:p.a.getters.grade,visible:!1,editVisible:!1,dialogVisible:!1,uploadVisible:!0,hideUpload:!1,total:20,current_page:1,pageSize:5,dialogImageUrl:"",companyList:[],locationList:[],diaLocationList:[],dinnersList:[],categoryList:[],goodsList:[],editFormdata:{name:"",m_id:"",dinner_id:"",chef:"",price:""},editDinnersList:[],editCategoryList:[],queryForm:{canteen_id:"",company_id:"",dinner_id:"",m_id:""},fileList:[],types_select:[],provider_select:[]}},components:{CuisineDialog:d,Pagination:u.a},created:function(){this.companiesVisible?this.getCompanies():this.getLocationList(0)},computed:{companiesVisible:function(){return 3!==this.grade}},methods:{fetchList:function(e){var t=this,i=Number(e)||1,n=this.queryForm,a=n.m_id,o=n.dinner_id,s=n.canteen_id,l=n.company_id;r.a.get("/v1/foods",{f_type:1,page:i,size:this.pageSize,company_ids:l,canteen_ids:s,dinner_ids:o,menu_ids:a}).then((function(e){t.goodsList=Array.from(e.data.data),t.current_page=e.data.current_page,t.total=e.data.total})).catch((function(e){return console.log(e)}))},getCompanies:function(){var e=this;r.a.get("/v1/admin/companies").then((function(t){var i=t.data,n=Object(m.a)(i);e.companyList=Object(m.b)(n),e.queryForm.canteen_id=null,e.queryForm.dinner_id=null,e.queryForm.m_id=null})).catch((function(e){return console.log(e)}))},getLocationList:function(e){var t=this;this.queryForm.canteen_id=null,this.queryForm.dinner_id=null,this.queryForm.m_id=null,isNaN(e)?(this.locationList=[],this.categoryList=[],this.dinnersList=[]):e?r.a.get("/v1/canteens?company_id=".concat(e)).then((function(e){t.diaLocationList=Array.from(e.data),t.locationList=Object(m.b)(Array.from(e.data))})).catch((function(e){return console.log(e)})):r.a.get("/v1/managerCanteens").then((function(e){t.diaLocationList=Array.from(e.data),t.locationList=Object(m.b)(Array.from(e.data))})).catch((function(e){return console.log(e)}))},getDinnersList:function(e){var t=this;isNaN(e)?(this.queryForm.dinner_id="",this.queryForm.m_id="",this.dinnersList=[]):r.a.get("/v1/canteen/dinners?canteen_id=".concat(e)).then((function(e){t.dinnersList=Object(m.b)(Array.from(e.data))})).catch((function(e){return console.log(e)}))},getCategoryList:function(e){var t=this;isNaN(e)?(this.categoryList=[],this.queryForm.m_id=""):r.a.get("/v1/menus/dinner?dinner_id=".concat(e)).then((function(e){t.categoryList=Object(m.b)(Array.from(e.data))})).catch((function(e){return console.log(e)}))},getEditDinnerList:(L=y(a.a.mark((function e(t){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.get("/v1/canteen/dinners?canteen_id=".concat(t)).then((function(e){i.editDinnersList=Array.from(e.data)})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)}),getEditCategoryList:(_=y(a.a.mark((function e(t){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.get("/v1/menus/dinner?dinner_id=".concat(t)).then((function(e){i.editCategoryList=Array.from(e.data)})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)}),_edit:(v=y(a.a.mark((function e(t){var i,n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],this.fileList.push(Object.assign({},{name:"".concat(t.name,".jpg"),url:t.img_url})),this.hideUpload=!0,this.editVisible=!0,this.editFormdata=h({},t),delete this.editFormdata.img_url,e.next=10,r.a.get("/v1/food",{id:t.id}).then((function(e){i=e.data;var t=e.data,a=t.dinner_id,r=t.canteen_id;n.getEditDinnerList(r),n.getEditCategoryList(a),n.editFormdata.dinner_id=i.dinner_id,n.editFormdata.m_id=i.menu_id})).catch((function(e){return console.log(e)}));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)}),handleClose:function(e){this.fileList=new Array,this.editVisible=!1},closeDialog:function(e){this.editData={},this.visible=e},confirmEdit:function(){var e=this.editFormdata;r.a.post("/v1/food/update",e).then((function(e){return console.log(e)})).catch((function(e){return console.log(e)}))},openNewType:function(){this.newTypeVisible=!0},addCuisine:function(){this.visible=!0},_add:function(){this.fetchList(this.page)},handleClickPage:function(e){this.page=e,this.fetchList(e)},handleNext:function(e){this.page=e,this.fetchList(e)},handlePrev:function(e){this.page=e,this.fetchList(e)},handleChange:function(e,t){this.hideUpload=t.length>=this.limit},handleRemove:function(e,t){this.hideUpload=t.length>=this.limit},handlePreview:function(e){console.log(e)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleSuccess:function(e,t,i){this.editFormdata.img_url=e.data.url,console.log(this.editFormdata)},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该商品, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$axios.post("/NewJMConsumeJMHG/Mall.ashx",{types:"delete_goods",postID:e.postID}).then((function(){t.fetchList(t.page),t.$message({type:"success",message:"删除成功!"})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}}},C=(i("412c"),Object(c.a)(F,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"cuisine-manage"},[i("span",{staticClass:"nav-title"},[e._v("菜品管理")]),i("el-divider"),i("div",{staticClass:"main"},[i("div",{staticClass:"main-header"},[i("el-form",{attrs:{inline:!0,"label-width":"80px",model:e.queryForm}},[e.companiesVisible?i("el-form-item",{attrs:{label:"公司",prop:"company_ids"}},[i("el-select",{on:{change:e.getLocationList},model:{value:e.queryForm.company_id,callback:function(t){e.$set(e.queryForm,"company_id",t)},expression:"queryForm.company_id"}},e._l(e.companyList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),i("el-form-item",{attrs:{label:"消费地点",prop:"canteen_id"}},[i("el-select",{on:{change:e.getDinnersList},model:{value:e.queryForm.canteen_id,callback:function(t){e.$set(e.queryForm,"canteen_id",t)},expression:"queryForm.canteen_id"}},e._l(e.locationList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"餐次",prop:"dinner_id"}},[i("el-select",{on:{change:e.getCategoryList},model:{value:e.queryForm.dinner_id,callback:function(t){e.$set(e.queryForm,"dinner_id",t)},expression:"queryForm.dinner_id"}},e._l(e.dinnersList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"类型",prop:"category"}},[i("el-select",{model:{value:e.queryForm.m_id,callback:function(t){e.$set(e.queryForm,"m_id",t)},expression:"queryForm.m_id"}},e._l(e.categoryList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-button",{attrs:{type:"primary"},on:{click:e.fetchList}},[e._v("查询")]),i("el-button",{attrs:{disabled:0===e.locationList.length},on:{click:e.addCuisine}},[e._v("新增")])],1)],1),i("div",{staticClass:"main-content"},e._l(e.goodsList,(function(t){return i("el-card",{key:t.postID,staticClass:"card",attrs:{"body-style":{padding:0}}},[i("div",{staticClass:"image"},[i("img",{attrs:{src:t.img_url,alt:""}})]),i("div",{staticStyle:{padding:"14px"}},[i("ul",{staticClass:"main-title"},[i("li",{staticClass:"list"},[e._v("名称:"+e._s(t.name))]),i("li",{staticClass:"list"},[e._v("价格:"+e._s(t.price))]),i("li",{staticClass:"list"},[e._v("类型:"+e._s(t.menu))]),i("li",{staticClass:"list"},[e._v("主厨:"+e._s(t.chef))])]),i("div",{staticClass:"btns"},[i("el-button",{attrs:{type:"danger",plain:""},on:{click:function(i){return e.handleDelete(t)}}},[e._v("删除")]),i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e._edit(t)}}},[e._v("编辑")])],1)])])})),1),e.goodsList.length>0?i("pagination",{attrs:{total:e.total,page:e.current_page,pageSize:e.pageSize,background:""},on:{pagination:e.fetchList}}):e._e()],1)],1),i("cuisine-dialog",{attrs:{c_id:e.queryForm.company_id,visible:e.visible,canteenList:e.diaLocationList},on:{closeDialog:e.closeDialog,_add:e._add}}),i("el-dialog",{attrs:{visible:e.editVisible,title:"编辑",width:"30%","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.editVisible=t}}},[i("el-form",{ref:"editForm",attrs:{model:e.editFormdata,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"类型",prop:"m_id"}},[i("el-select",{attrs:{disabled:""},model:{value:e.editFormdata.m_id,callback:function(t){e.$set(e.editFormdata,"m_id",t)},expression:"editFormdata.m_id"}},e._l(e.editCategoryList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"餐次",prop:"dinner_id"}},[i("el-select",{attrs:{disabled:""},model:{value:e.editFormdata.dinner_id,callback:function(t){e.$set(e.editFormdata,"dinner_id",t)},expression:"editFormdata.dinner_id"}},e._l(e.editDinnersList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{model:{value:e.editFormdata.name,callback:function(t){e.$set(e.editFormdata,"name",t)},expression:"editFormdata.name"}})],1),i("el-form-item",{attrs:{label:"价格",prop:"price"}},[i("el-input",{model:{value:e.editFormdata.price,callback:function(t){e.$set(e.editFormdata,"price",t)},expression:"editFormdata.price"}})],1),i("el-form-item",{attrs:{label:"主厨",prop:"chef"}},[i("el-input",{model:{value:e.editFormdata.chef,callback:function(t){e.$set(e.editFormdata,"chef",t)},expression:"editFormdata.chef"}})],1),i("el-form-item",{staticStyle:{display:"block"},attrs:{label:"图片"}},[i("el-upload",{ref:"editUpload",class:{hide:e.hideUpload},attrs:{action:"/v1/image/upload",name:"image","file-list":e.fileList,"list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-change":e.handleChange,"on-success":e.handleSuccess}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.confirmEdit}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null));t.default=C.exports},7361:function(e,t,i){},"9cef":function(e,t,i){}}]);