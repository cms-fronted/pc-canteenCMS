(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-03bd9746"],{"058e":function(e,t,n){},2401:function(e,t,n){"use strict";var i=n("9ff1");n.n(i).a},"354b":function(e,t,n){"use strict";var i=n("058e");n.n(i).a},"53bf":function(e,t,n){"use strict";var i=n("9c9d");n.n(i).a},"9c9d":function(e,t,n){},"9ff1":function(e,t,n){},a5e4:function(e,t,n){"use strict";n.r(t);var i=n("a34a"),a=n.n(i),o=n("365c"),s=n("575f");function r(e,t,n,i,a,o,s){try{var r=e[o](s),c=r.value}catch(e){return void n(e)}r.done?t(c):Promise.resolve(c).then(i,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,c,"next",e)}function c(e){r(o,i,a,s,c,"throw",e)}s(void 0)}))}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u,m=[{label:"周一",value:0},{label:"周二",value:1},{label:"周三",value:2},{label:"周四",value:3},{label:"周五",value:4},{label:"周六",value:5},{label:"周日",value:6}],p={props:["visible","company_id","dialogTitle","isEdit","formdata","editDinnerList","editAccount","machineList","modules"],data:function(){return{testCheck:[],isOpen:!1,dinnersVisible:!1,addMachineVisible:!1,editDinnerData:this.editDinnerList,editAccountForm:this.editAccount,isEditMachine:!1,machineForm:{id:"",belong_id:"",name:"",code:"",number:"",pwd:""},canteen_id:null,canteens:null,advancedType:1,day:"",week:"",weekOptions:m,dinnerForm:{name:"",type:"day",type_number:"",limit_time:"",meal_time_begin:"",meal_time_end:"",fixed:1},accountForm:{type:"",clean_type:"",dining_mode:1,clean_day:1,clean_time:"08:00",limit_money:1},dataTable:[],machineTable:[]}},watch:{visible:function(e){this.isOpen=e},formdata:function(e){this.canteens=e.name},editDinnerList:function(e){this.isEdit&&(this.dataTable=e)},editAccount:function(e){this.isEdit&&(this.accountForm=e)},machineList:function(e){this.isEdit&&(this.machineTable=e)}},created:function(){},methods:{handleClick:function(){this.dinnersVisible=!0},addCanteen:function(){var e=this;o.a.post("http://canteen.tonglingok.com/api/v1/canteen/save",{canteens:this.canteens,c_id:this.company_id}).then((function(t){e.canteens="",e.canteen_id=t.data.canteen_id,e.$message.success("饭堂创建成功，请继续操作")})).catch((function(t){e.$message.error("饭堂名称不能为空!")}))},_addDinner:function(){this.dataTable.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.dinnerForm)),this.$refs.dinnerForm.resetFields(),this.dinnersVisible=!1},_submitOptions:function(){var e=this,t={};t.dinners=JSON.stringify(this.dataTable),t.account=JSON.stringify(this.accountForm),this.isEdit?t.c_id=this.formdata.id:t.c_id=this.canteen_id;var n=this.isEdit?"http://canteen.tonglingok.com/api/v1/canteen/configuration/update":"http://canteen.tonglingok.com/api/v1/canteen/configuration/save";o.a.post(n,t).then((function(t){e.$message.success("设置成功"),e.dataTable.length=0,e.$emit("updateCanteenList",e.company_id),e.handleClose()})).catch((function(e){return console.log(e)}))},handleClose:function(){this.dataTable.length=0,this.$refs.accountForm.resetFields(),this.$emit("closeAdd",!1)},changeDay:function(e){this.accountForm.clean_day=e>31?31:e},oprnMachineDialog:function(){this.addMachineVisible=!0,this.machineForm={}},closeMachineDialog:function(){this.addMachineVisible=!1,this.isEditMachine=!1,this.machineForm={}},_deleteMachine:(u=c(a.a.mark((function e(t){var n,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.id,this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(c(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.post("http://canteen.tonglingok.com/api/v1/canteen/deleteMachine",{id:n});case 2:if("ok"!==e.sent.msg){e.next=7;break}return i.$message({type:"success",message:"删除成功!"}),e.next=7,i.getCompanyMachine(i.company_id);case 7:case"end":return e.stop()}}),e)})))).catch((function(){i.$message({type:"info",message:"已取消删除"})}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)}),_editMachine:function(e){this.isEditMachine=!0,this.machineForm=Object.assign({},e),this.addMachineVisible=!0},_submitMachineInfo:function(){var e=this;this.isEditMachine?o.a.post("http://canteen.tonglingok.com/api/v1/canteen/updateMachine",this.machineForm).then((function(t){e.$emit("updateMachineTable",{id:e.canteen_id||e.formdata.id},"canteen"),e.closeMachineDialog(),e.$message.success("修改成功")})).catch((function(e){return console.log(e)})):(this.machineForm.belong_id=this.formdata.id||this.canteen_id,this.machineForm.company_id=this.company_id,this.machineForm.machine_type="canteen",console.log(this.machineForm),o.a.post("v1/canteen/saveMachine",this.machineForm).then((function(t){e.$emit("updateMachineTable",{id:e.canteen_id||e.formdata.id},"canteen"),e.closeMachineDialog(),e.$message.success("添加成功")})).catch((function(e){return console.log(e)})))}}},h=(n("53bf"),n("2877")),f=Object(h.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{attrs:{visible:e.isOpen,width:"45%",title:e.dialogTitle,center:""},on:{"update:visible":function(t){e.isOpen=t},close:e.handleClose}},[n("el-dialog",{attrs:{center:"",width:"40%",visible:e.dinnersVisible,"append-to-body":""},on:{"update:visible":function(t){e.dinnersVisible=t},close:function(t){e.dinnersVisible=!1}}},[n("el-form",{ref:"dinnerForm",attrs:{model:e.dinnerForm,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"餐次名称",prop:"name"}},[n("el-input",{staticStyle:{width:"150px"},model:{value:e.dinnerForm.name,callback:function(t){e.$set(e.dinnerForm,"name",t)},expression:"dinnerForm.name"}})],1),n("el-form-item",{attrs:{label:"消费状态",prop:"fixed"}},[n("el-radio-group",{model:{value:e.dinnerForm.fixed,callback:function(t){e.$set(e.dinnerForm,"fixed",t)},expression:"dinnerForm.fixed"}},[n("el-radio",{attrs:{label:1}},[e._v("固定")]),n("el-radio",{attrs:{label:2}},[e._v("动态")])],1)],1),n("el-form-item",{attrs:{label:"订餐截止日期","label-width":"120px",prop:"type"}},[n("el-radio-group",{on:{change:function(t){e.dinnerForm.type_number=""}},model:{value:e.dinnerForm.type,callback:function(t){e.$set(e.dinnerForm,"type",t)},expression:"dinnerForm.type"}},[n("el-radio",{attrs:{label:"day"}},[e._v("\n              天\n              "),"day"==e.dinnerForm.type?n("span",[e._v("\n                提前\n                "),n("el-input",{staticStyle:{width:"50px"},model:{value:e.dinnerForm.type_number,callback:function(t){e.$set(e.dinnerForm,"type_number",t)},expression:"dinnerForm.type_number"}}),e._v("天\n              ")],1):e._e()]),n("el-radio",{attrs:{label:"week"}},[e._v("\n              周\n              "),"week"==e.dinnerForm.type?n("span",[e._v("\n                提前\n                "),n("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},model:{value:e.dinnerForm.type_number,callback:function(t){e.$set(e.dinnerForm,"type_number",t)},expression:"dinnerForm.type_number"}},e._l(e.weekOptions,(function(e){return n("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)],1):e._e()])],1)],1),n("el-form-item",{attrs:{label:"",prop:"limit_time"}},[n("el-time-select",{staticStyle:{marginTop:"5px",marginLeft:"5px"},attrs:{"picker-options":{start:"00:00",step:"00:01",end:"23:59"},placeholder:"请选择时间"},model:{value:e.dinnerForm.limit_time,callback:function(t){e.$set(e.dinnerForm,"limit_time",t)},expression:"dinnerForm.limit_time"}})],1),n("el-form-item",{attrs:{label:"就餐时间",prop:"meal_time"}},[n("el-time-select",{staticStyle:{width:"100px"},attrs:{placeholder:"起始","picker-options":{start:"00:00",step:"00:01",end:"23:59"}},model:{value:e.dinnerForm.meal_time_begin,callback:function(t){e.$set(e.dinnerForm,"meal_time_begin",t)},expression:"dinnerForm.meal_time_begin"}}),n("span",{staticStyle:{margin:"0 10px"}},[e._v("——")]),n("el-time-select",{staticStyle:{width:"100px"},attrs:{placeholder:"结束","picker-options":{start:"00:00",step:"00:01",end:"23:59",minTime:e.dinnerForm.meal_time_begin}},model:{value:e.dinnerForm.meal_time_end,callback:function(t){e.$set(e.dinnerForm,"meal_time_end",t)},expression:"dinnerForm.meal_time_end"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dinnersVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._addDinner}},[e._v("确定")])],1)],1),n("el-dialog",{attrs:{visible:e.addMachineVisible,width:"40%","append-to-body":"",title:"新增硬件"},on:{"update:visible":function(t){e.addMachineVisible=t},close:function(t){e.addMachineVisible=!1}}},[n("el-form",{ref:"machineForm",attrs:{model:e.machineForm,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[n("el-input",{model:{value:e.machineForm.name,callback:function(t){e.$set(e.machineForm,"name",t)},expression:"machineForm.name"}})],1),n("el-form-item",{attrs:{label:"设备号",prop:"code"}},[n("el-input",{model:{value:e.machineForm.code,callback:function(t){e.$set(e.machineForm,"code",t)},expression:"machineForm.code"}})],1),n("el-form-item",{attrs:{label:"编号",prop:"number"}},[n("el-input",{model:{value:e.machineForm.number,callback:function(t){e.$set(e.machineForm,"number",t)},expression:"machineForm.number"}})],1),e.isEditMachine?e._e():n("el-form-item",{attrs:{label:"密码",prop:"pwd"}},[n("el-input",{attrs:{"show-password":""},model:{value:e.machineForm.pwd,callback:function(t){e.$set(e.machineForm,"pwd",t)},expression:"machineForm.pwd"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeMachineDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._submitMachineInfo}},[e._v("确 定")])],1)],1),n("el-card",{attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("饭堂设置")])]),n("span",{staticStyle:{"margin-right":"8px"}},[e._v("\n        饭堂名称\n        "),n("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",disabled:e.isEdit},model:{value:e.canteens,callback:function(t){e.canteens=t},expression:"canteens"}})],1),n("el-button",{attrs:{type:"primary",size:"small",disabled:e.isEdit||e.canteen_id},on:{click:e.addCanteen}},[e._v("新增饭堂")]),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleClick}},[e._v("添加餐次")]),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataTable,size:"small"}},[n("el-table-column",{attrs:{label:"餐次",width:"60px",prop:"name"}}),n("el-table-column",{attrs:{label:"订餐截止时间"},scopedSlots:e._u([{key:"default",fn:function(t){return n("span",{},[e._v("\n            "+e._s("day"===t.row.type?"提前"+t.row.type_number+"天":"周"+(t.row.type_number+1)+"前")+"\n          ")])}}])}),n("el-table-column",{attrs:{label:"就餐时间"},scopedSlots:e._u([{key:"default",fn:function(t){return n("span",{},[e._v("\n            "+e._s(t.row.meal_time_begin)+"-"+e._s(t.row.meal_time_end)+"\n          ")])}}])}),n("el-table-column",{attrs:{label:"餐费状态"},scopedSlots:e._u([{key:"default",fn:function(t){return n("span",{},[e._v("\n            "+e._s(1===t.row.fixed?"固定":"动态")+"\n          ")])}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small",type:"text"}},[e._v("编辑")]),n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){return e._delete(t.row)}}},[e._v("删除")])]}}])})],1)],1),n("el-card",{staticClass:"box-card",attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("账户设置")]),n("el-form",{ref:"accountForm",attrs:{model:e.accountForm}},[n("el-form-item",{attrs:{prop:"dinningMode"}},[n("el-radio-group",{model:{value:e.accountForm.dining_mode,callback:function(t){e.$set(e.accountForm,"dining_mode",t)},expression:"accountForm.dining_mode"}},[n("el-radio",{attrs:{label:1}},[e._v("堂食")]),n("el-radio",{attrs:{label:2}},[e._v("外卖")]),n("el-radio",{attrs:{label:3}},[e._v("全部")])],1)],1),n("el-form-item",{attrs:{prop:"type"}},[n("el-radio-group",{model:{value:e.accountForm.type,callback:function(t){e.$set(e.accountForm,"type",t)},expression:"accountForm.type"}},[n("el-radio",{attrs:{label:2}},[e._v("不可透支消费")]),n("el-radio",{attrs:{label:1}},[e._v("可透支消费")])],1),1===e.accountForm.type?n("span",{staticStyle:{marginTop:"5px"}},[e._v("\n            可透支\n            "),n("el-input",{staticStyle:{width:"120px"},attrs:{size:"small",type:"number",min:"0"},model:{value:e.accountForm.limit_money,callback:function(t){e.$set(e.accountForm,"limit_money",t)},expression:"accountForm.limit_money"}}),e._v("元\n          ")],1):e._e()],1)],1)],1),n("el-card",{staticClass:"box-card",attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("硬件设置")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.oprnMachineDialog}},[e._v("添加硬件")])],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.machineTable,size:"mini"}},[n("el-table-column",{attrs:{label:"编号",prop:"number"}}),n("el-table-column",{attrs:{label:"设备名称",prop:"name"}}),n("el-table-column",{attrs:{label:"设备号",prop:"code"}}),n("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(1===t.row.state?"正常":"异常"))])]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){return e._editMachine(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){return e._deleteMachine(t.row)}}},[e._v("删除")])]}}])})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._submitOptions}},[e._v("确定")])],1)],1)],1)}),[],!1,null,"0deae6ec",null).exports;function b(e,t,n,i,a,o,s){try{var r=e[o](s),c=r.value}catch(e){return void n(e)}r.done?t(c):Promise.resolve(c).then(i,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){b(o,i,a,s,r,"next",e)}function r(e){b(o,i,a,s,r,"throw",e)}s(void 0)}))}}var v={data:function(){return{isOpen:!1,shop_name:"",taking_mode:1,addMachineVisible:!1,isEditMachine:!1,checkAll:{system:!1,shop:!1,canteen:!1},modulesCheckbox:{system:[],canteen:[],shop:[]},checkedModules:{system:[],shop:[],canteen:[]},shop_id:"",machineForm:{belong_id:"",id:"",name:"",code:"",number:"",pwd:""},isIndeterminate:{system:!1,shop:!1,canteen:!1},machineTable:[],modules:[]}},props:["visible","company_id","dialogTitle","isEdit","formdata","machineList"],watch:{visible:function(e){this.isOpen=e},formdata:function(e){this.shop_name=e.name},machineList:function(e){this.isEdit&&(this.machineTable=e)}},created:function(){},methods:{closeDialog:function(){this.shop_name="",this.shop_id="",this.taking_mode=1,this.$emit("closeDialog",!1)},handleCheckAllChange:function(e,t){this.checkedModules[""+t]=e?this.modulesCheckbox[""+t]:[],this.isIndeterminate[""+t]=!1},handleCheckedModulesChange:function(e,t){var n=e.length;this.checkAll[""+t]=n===this.modulesCheckbox[""+t].length,this.isIndeterminate[""+t]=n>0&&n<this.modulesCheckbox[""+t].length},addNewMachine:function(){this.addMachineVisible=!0,this.machineForm={}},closeMachineDialog:function(){this.addMachineVisible=!1,this.isEditMachine=!1,this.machineForm={}},_editMachine:function(e){this.isEditMachine=!0,this.machineForm=Object.assign({},e),this.addMachineVisible=!0},_submitMachineInfo:function(){var e=this;this.isEditMachine?o.a.post("http://canteen.tonglingok.com/api/v1/canteen/updateMachine",this.machineForm).then((function(t){e.$emit("updateMachineTable",{id:e.canteen_id||e.formdata.id},"shop"),e.closeMachineDialog(),e.$message.success("修改成功")})).catch((function(e){return console.log(e)})):(this.machineForm.belong_id=this.formdata.id||this.shop_id,this.machineForm.company_id=this.company_id,this.machineForm.machine_type="shop",console.log(this.machineForm),o.a.post("v1/canteen/saveMachine",this.machineForm).then((function(t){e.$emit("updateMachineTable",{id:e.canteen_id||e.formdata.id},"shop"),e.closeMachineDialog(),e.$message.success("添加成功")})).catch((function(e){return console.log(e)})))},addShop:function(){var e=this;o.a.post("http://canteen.tonglingok.com/api/v1/shop/save",{c_id:this.company_id,name:this.shop_name,taking_mode:this.taking_mode}).then((function(t){"ok"===t.msg?(e.$message.success("新增成功"),e.shop_id=t.data.shop_id):e.$message.error(t.msg)})).catch((function(e){return console.log(e)}))},editShop:function(){var e=this;o.a.post("http://canteen.tonglingok.com/api/v1/shop/update",{id:this.formdata.id,name:this.shop_name,taking_mode:this.taking_mode}).then((function(t){"ok"===t.msg&&e.$message.success("修改成功")})).catch((function(e){return console.log(e)}))},_deleteMachine:function(){var e=g(a.a.mark((function e(t){var n,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.id,this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(g(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.post("http://canteen.tonglingok.com/api/v1/canteen/deleteMachine",{id:n});case 2:if("ok"!==e.sent.msg){e.next=7;break}return i.$message({type:"success",message:"删除成功!"}),e.next=7,i.getCompanyMachine(i.company_id);case 7:case"end":return e.stop()}}),e)})))).catch((function(){i.$message({type:"info",message:"已取消删除"})}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}},_=(n("2401"),Object(h.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{attrs:{visible:e.isOpen,width:"40%",center:"",title:e.dialogTitle},on:{"update:visible":function(t){e.isOpen=t},close:e.closeDialog}},[n("el-dialog",{attrs:{visible:e.addMachineVisible,width:"40%","append-to-body":"",title:"新增硬件"},on:{"update:visible":function(t){e.addMachineVisible=t},close:e.closeMachineDialog}},[n("el-form",{ref:"machineForm",attrs:{model:e.machineForm,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[n("el-input",{model:{value:e.machineForm.name,callback:function(t){e.$set(e.machineForm,"name",t)},expression:"machineForm.name"}})],1),n("el-form-item",{attrs:{label:"设备号",prop:"code"}},[n("el-input",{model:{value:e.machineForm.code,callback:function(t){e.$set(e.machineForm,"code",t)},expression:"machineForm.code"}})],1),n("el-form-item",{attrs:{label:"编号",prop:"number"}},[n("el-input",{model:{value:e.machineForm.number,callback:function(t){e.$set(e.machineForm,"number",t)},expression:"machineForm.number"}})],1),e.isEditMachine?e._e():n("el-form-item",{attrs:{label:"密码",prop:"pwd"}},[n("el-input",{attrs:{"show-password":""},model:{value:e.machineForm.pwd,callback:function(t){e.$set(e.machineForm,"pwd",t)},expression:"machineForm.pwd"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeMachineDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._submitMachineInfo}},[e._v("确 定")])],1)],1),n("el-card",{attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("小卖部")])]),n("div",[n("span",{staticStyle:{"margin-right":"8px"}},[e._v("\n          小卖部名称\n          "),n("el-input",{staticStyle:{width:"200px",marginRight:"10px"},attrs:{size:"small",disabled:!!e.shop_id},model:{value:e.shop_name,callback:function(t){e.shop_name=t},expression:"shop_name"}})],1),n("div",{staticStyle:{marginTop:"5px"}},[n("el-radio-group",{model:{value:e.taking_mode,callback:function(t){e.taking_mode=t},expression:"taking_mode"}},[n("el-radio",{attrs:{label:1}},[e._v("自取")]),n("el-radio",{attrs:{label:2}},[e._v("外卖")]),n("el-radio",{attrs:{label:3}},[e._v("全部")])],1),e.isEdit?n("el-button",{staticStyle:{marginLeft:"5px"},attrs:{type:"primary",size:"small",disabled:!e.shop_name},on:{click:e.editShop}},[e._v("编辑小卖部")]):n("el-button",{staticStyle:{marginLeft:"5px"},attrs:{type:"primary",size:"small",disabled:!e.shop_name},on:{click:e.addShop}},[e._v("新增小卖部")])],1)])]),n("el-card",{staticClass:"box-card",attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("硬件设置")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.addNewMachine}},[e._v("添加硬件")])],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.machineTable,size:"mini"}},[n("el-table-column",{attrs:{label:"编号",prop:"number"}}),n("el-table-column",{attrs:{label:"设备名称",prop:"name"}}),n("el-table-column",{attrs:{label:"设备号",prop:"code"}}),n("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(1===t.row.state?"正常":"异常"))])]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){return e._editMachine(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){return e._deleteMachine(t.row)}}},[e._v("删除")])]}}])})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.closeDialog}},[e._v("确定")])],1)],1)],1)}),[],!1,null,"acbeee12",null).exports);function y(e,t,n,i,a,o,s){try{var r=e[o](s),c=r.value}catch(e){return void n(e)}r.done?t(c):Promise.resolve(c).then(i,a)}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,a=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function x(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F,C,M={props:["visible","modules","company_id"],data:function(){return{isOpen:!1,addModulesIds:[],checkAll:{},modulesCheckbox:{},checkedModules:{},checkedWXAllModules:{},isIndeterminate:{},pcModules:[],allModules:[],WXModules:[],defaultModules:[]}},watch:{visible:function(e){this.isOpen=e},modules:function(e){this.initData(e)}},methods:{initData:function(e){var t=this,n=Object(s.c)(e);this.allModules=n,this.defaultModules=[],e.forEach((function(e){var n=e.id;t.checkAll=Object.assign({},t.checkAll,w({},n,!1)),t.isIndeterminate=Object.assign({},t.isIndeterminate,w({},n,!1)),t.checkedModules=Object.assign({},t.checkedModules,w({},n,[])),t.modulesCheckbox=Object.assign({},t.modulesCheckbox,w({},n,[]))})),this.pcModules=e.filter((function(e){return 1===e.type})),this.WXModules=e.filter((function(e){return 2===e.type}));var i=Object(s.c)(this.pcModules),a=Object(s.c)(this.WXModules);this.initCheckBox(i,this.modulesCheckbox,this.checkedModules,this.checkAll,this.isIndeterminate),this.initCheckBox(a,this.modulesCheckbox,this.checkedWXAllModules,this.checkAll,this.isIndeterminate),n.forEach((function(e){1===e.have&&t.defaultModules.push(e.id)}))},initCheckBox:function(e,t,n,i,a){var o=this;e.forEach((function(e){var s=e.id,r=e.parent_id;r&&t[r].push(s),1===e.have&&e.parent_id?(n[r].push(e.id),i[r]=n[r].length===t[r].length):1!==e.have||0!==r||e.items||(o.checkAll[s]=!0),r&&(a[r]=n[r].length>0&&n[r].length<t[r].length)}))},handleCheckAllChange:function(e,t){this.checkedModules[""+t]=e?this.modulesCheckbox[""+t]:[],this.isIndeterminate[""+t]=!1},handleCheckedModulesChange:function(e,t){var n=e.length;this.checkAll[""+t]=n===this.modulesCheckbox[""+t].length,this.isIndeterminate[""+t]=n>0&&n<this.modulesCheckbox[""+t].length},closeDialog:function(){this.$emit("closeDialog",!1)},handleData:function(){for(var e=this,t=[],n=[],i=this.defaultModules,a=[],o=[],s=this.checkAll,r=this.checkedModules,c=0,l=Object.entries(r);c<l.length;c++){var d=k(l[c],2),u=d[0],m=d[1];t.push(Array.from(m))}t=Array.from(new Set(t.flat(1/0))),n=x(t),t.forEach((function(t){e.allModules.filter((function(e){e.id===t&&n.push(e.parent_id)}))}));for(var p=0,h=Object.entries(s);p<h.length;p++){var f=k(h[p],2);u=f[0];(m=f[1])&&n.push(Number(u))}return n=Array.from(new Set(n)),i.length&&i.forEach((function(e){-1===n.indexOf(e)&&o.push(e)})),n.forEach((function(e){-1===i.indexOf(e)&&a.push(e)})),o=Array.from(new Set(o)),{_add:a,_cancel:o}},_edit:(F=a.a.mark((function e(){var t,n,i,s,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.handleData(),n=t._add,i=t._cancel,s=[],r={company_id:this.company_id,canteen:{cancel_modules:""}},n.length&&(n.forEach((function(e,t){s.push({m_id:e,order:t+1})})),r.canteen.add_modules=s),i.length&&(r.canteen.cancel_modules=i.join(",")),r.canteen=JSON.stringify(r.canteen),e.next=9,o.a.post("http://canteen.tonglingok.com/api/v1/module/company/update",r);case 9:"ok"===e.sent.msg?(this.$message.success("修改成功"),this.closeDialog()):this.$message.error("修改失败");case 11:case"end":return e.stop()}}),e,this)})),C=function(){var e=this,t=arguments;return new Promise((function(n,i){var a=F.apply(e,t);function o(e){y(a,n,i,o,s,"next",e)}function s(e){y(a,n,i,o,s,"throw",e)}o(void 0)}))},function(){return C.apply(this,arguments)})}};function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(n,!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t,n,i,a,o,s){try{var r=e[o](s),c=r.value}catch(e){return void n(e)}r.done?t(c):Promise.resolve(c).then(i,a)}function $(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){S(o,i,a,s,r,"next",e)}function r(e){S(o,i,a,s,r,"throw",e)}s(void 0)}))}}var A,T,L,j,V,P,z,I={components:{AddCanteenDialog:f,AddShopDialog:_,EditEnterpriseDialog:Object(h.a)(M,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.isOpen,width:"40%",center:"",title:"编辑企业模块"},on:{"update:visible":function(t){e.isOpen=t},close:e.closeDialog}},[n("el-card",{staticClass:"box-card"},[n("div",[e._v("PC端")]),e._l(e.pcModules,(function(t){return n("div",{key:t.create_time},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id]},on:{change:function(n){return e.handleCheckAllChange(n,t.id)}},model:{value:e.checkAll[t.id],callback:function(n){e.$set(e.checkAll,t.id,n)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))]),n("el-checkbox-group",{staticStyle:{padding:"0 20px"},on:{change:function(n){return e.handleCheckedModulesChange(n,t.id)}},model:{value:e.checkedModules[t.id],callback:function(n){e.$set(e.checkedModules,t.id,n)},expression:"checkedModules[item.id]"}},e._l(t.items,(function(t){return n("el-checkbox",{key:t.create_time,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1)})),n("div",[e._v("微信端")]),e._l(e.WXModules,(function(t){return n("div",{key:t.create_time},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id]},on:{change:function(n){return e.handleCheckAllChange(n,t.id)}},model:{value:e.checkAll[t.id],callback:function(n){e.$set(e.checkAll,t.id,n)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))])],1)}))],2),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._edit}},[e._v("确定")])],1)],1)}),[],!1,null,null,null).exports},data:function(){return{editEnterpriseDialogVisible:!1,addCanteenVisible:!1,addEnterpriseVisible:!1,addShopVisible:!1,payConfigVisible:!1,canteenDialogTitle:"",shopDialogTitle:"",editDinnersList:[],machineList:[],editAccount:{type:"",clean_type:"",clean_day:1,clean_time:"08:00",limit_money:1,id:"",dining_mode:1},companyList:[],modules:{},canteensLocData:[],shopLocData:[],company_id:"",filterText:"",isEdit:!1,parent:{id:"",name:""},defaultProps:{children:"items",label:"name"},enterpriseForm:{name:""},editForm:{dinnersList:[],account:{}},payConfigForm:{}}},created:function(){this.fetchCompanyList()},watch:{filterText:function(e){this.$refs.tree.filter(e)}},methods:{handleNodeClick:function(e){var t=e.id,n=e.name;this.company_id=t,this.parent.id=t,this.parent.name=n,this.getComsumptionLoc(t)},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},getComsumptionLoc:function(e){var t=this;this.shopLocData=[],o.a.get("http://canteen.tonglingok.com/api/v1/company/consumptionLocation?company_id=".concat(e)).then((function(e){t.canteensLocData=Array.from(e.data.canteen),e.data.shop&&t.shopLocData.push(e.data.shop)})).catch((function(e){return console.log(e)}))},fetchCompanyList:function(){var e=this;o.a.get("http://canteen.tonglingok.com/api/v1/admin/companies").then((function(t){e.companyList=Array.from(t.data)})).catch((function(e){return console.log(e)}))},addCanteen:function(){this.canteenDialogTitle="新增饭堂",this.isEdit=!1,this.editForm={},this.addCanteenVisible=!0},_cancelCanteen:function(e){this.addCanteenVisible=e,this.editDinnersList.length=0,this.editAccount={},this.modules=[]},addShop:function(){this.shopDialogTitle="新增小卖部",this.addShopVisible=!0},addPayConfig:function(){this.payConfigVisible=!0},closePayConfig:function(){this.payConfigVisible=!1,this.payConfigForm={}},_addPayConfig:(z=$(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.assign({},this.payConfigForm,{company_id:this.company_id}),console.log(t),e.next=4,o.a.post("http://canteen.tonglingok.com/api/v1/company/wxConfig/save");case 4:"ok"===e.sent.msg?(this.$message.success("新增支付信息成功"),this.closePayConfig()):(this.$message.error("请填写正确信息"),this.closePayConfig());case 6:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)}),closeShopDialog:function(e){this.isEdit=e,this.addShopVisible=e},addEnterprise:function(e,t){this.parent.name=t.name,this.parent.id=t.id,this.addEnterpriseVisible=!0},editEnterpriseDialog:(P=$(a.a.mark((function e(t,n){var i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.id,this.company_id=i,e.next=4,this.getSystemModules(i);case 4:"ok"===(o=e.sent).msg&&(this.modules=Array.from(o.data)),this.editEnterpriseDialogVisible=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)}),closeEditEnterprise:function(e){this.editEnterpriseDialogVisible=e,this.modules=[]},_addEnterprise:function(){var e=this;o.a.post("http://canteen.tonglingok.com/api/v1/company/save",{parent_id:this.parent.id||0,name:this.enterpriseForm.name}).then((function(t){e.fetchCompanyList(),e.addEnterpriseVisible=!1,e.$message.success("添加成功，企业账号为:".concat(t.data.company_id,"-admin")),e.$refs.newEnterprise.resetFields(),e.parent.id="",e.parent_name=""})).catch((function(e){return console.log(e)}))},getCanteenConfig:(V=$(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.next=3,o.a.get("http://canteen.tonglingok.com/api/v1/canteen/configuration?c_id=".concat(t)).then((function(e){n=e.data})).catch((function(e){return console.log(e)}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),function(e){return V.apply(this,arguments)}),getSystemModules:(j=$(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.a.get("http://canteen.tonglingok.com/api/v1/modules/canteen/withSystem",{c_id:t}),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)}),_editCanteen:(L=$(a.a.mark((function e(t){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,this.isEdit=!0,this.editForm=t,this.canteenDialogTitle="编辑饭堂",e.next=6,this.getCanteenConfig(n);case 6:i=e.sent,this.getMachineList(t,"canteen"),"ok"===i.msg&&(this.editForm.dinnersList=i.dinners),this.editDinnersList=Array.from(i.dinners),this.editAccount=D({},i.account),this.addCanteenVisible=!0;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)}),_editShop:(T=$(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.editForm=t,this.isEdit=!0,this.shopDialogTitle="编辑小卖部",this.getMachineList(t,"shop"),this.addShopVisible=!0;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)}),getMachineList:(A=$(a.a.mark((function e(t,n){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.get("http://canteen.tonglingok.com/api/v1/machines",{belong_id:t.id,machine_type:n,page:1,size:10}).then((function(e){i.machineList=Array.from(e.data.data)})).catch((function(e){return console.log(e)}));case 2:return e.abrupt("return",void 0);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return A.apply(this,arguments)})}},B=(n("354b"),Object(h.a)(I,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"enterprise-manage"},[n("div",{staticClass:"nav-title"},[e._v("企业管理")]),n("el-divider"),n("div",{staticClass:"main"},[n("div",{staticClass:"main-header"},[n("el-button",{attrs:{type:"primary"},on:{click:function(){return e.addEnterprise({},{})}}},[e._v("新增一级企业")])],1),n("div",{staticClass:"main-content"},[n("el-row",{attrs:{gutter:10}},[n("el-col",{attrs:{span:6}},[n("el-card",[n("div",[n("el-input",{attrs:{placeholder:"关键字查询",size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),n("el-tree",{ref:"tree",attrs:{data:e.companyList,props:e.defaultProps,"node-key":"id","filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return n("span",{staticClass:"enterprise-tree-node"},[n("span",[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleNodeClick(a)}}},[e._v(e._s(i.label))])],1),n("span",{staticClass:"btns-text"},[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.editEnterpriseDialog(i,a)}}},[e._v("编辑")]),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.addEnterprise(i,a)}}},[e._v("新增")])],1)])}}])})],1)])],1),n("el-col",{attrs:{span:16}},[n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("云饭堂")])]),n("div",{staticClass:"card-content"},[n("el-button",{attrs:{disabled:!e.company_id},on:{click:e.addCanteen}},[e._v("新增饭堂")]),n("el-button",{attrs:{disabled:!e.company_id},on:{click:e.addShop}},[e._v("新增小卖部")]),n("el-button",{attrs:{disabled:!e.company_id},on:{click:e.addPayConfig}},[e._v("新增支付信息")]),n("el-table",{staticStyle:{width:"50%",margin:"0 auto"},attrs:{size:"mini",data:e.canteensLocData}},[n("div",{attrs:{slot:"empty"},slot:"empty"},[e._v("暂无饭堂")]),n("el-table-column",{attrs:{label:"消费地点",prop:"name"}}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e._editCanteen(t.row)}}},[e._v("操作")])],1)]}}])})],1),n("el-table",{staticStyle:{width:"50%",margin:"0 auto"},attrs:{size:"mini",data:e.shopLocData,"show-header":!1}},[n("div",{attrs:{slot:"empty"},slot:"empty"},[e._v("暂无小卖部")]),n("el-table-column",{attrs:{prop:"name"}}),n("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e._editShop(t.row)}}},[e._v("操作")])],1)]}}])})],1)],1)])],1)],1)],1)]),n("el-dialog",{attrs:{visible:e.addEnterpriseVisible,width:"40%",title:"新增企业"},on:{"update:visible":function(t){e.addEnterpriseVisible=t},close:function(t){e.addEnterpriseVisible=!1}}},[n("el-form",{ref:"newEnterprise",attrs:{model:e.enterpriseForm,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"企业名称",prop:"name"}},[n("el-input",{model:{value:e.enterpriseForm.name,callback:function(t){e.$set(e.enterpriseForm,"name",t)},expression:"enterpriseForm.name"}})],1),n("el-form-item",{attrs:{label:"上级企业"}},[n("el-input",{attrs:{disabled:!0,value:e.parent.name}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e._addEnterprise}},[e._v("确 定")])],1)],1),n("el-dialog",{attrs:{visible:e.payConfigVisible,width:"40%",title:"新增支付方式"},on:{close:e.closePayConfig}},[n("el-form",{ref:"newPayConfig",attrs:{model:e.payConfigForm,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"公众号appId"}},[n("el-input",{model:{value:e.payConfigForm.app_id,callback:function(t){e.$set(e.payConfigForm,"app_id",t)},expression:"payConfigForm.app_id"}})],1),n("el-form-item",{attrs:{label:"支付商户id"}},[n("el-input",{model:{value:e.payConfigForm.mch_id,callback:function(t){e.$set(e.payConfigForm,"mch_id",t)},expression:"payConfigForm.mch_id"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e._addPayConfig}},[e._v("确 定")]),n("el-button",{on:{click:e.closePayConfig}},[e._v("取 消")])],1)],1),n("add-canteen-dialog",{attrs:{dialogTitle:e.canteenDialogTitle,visible:e.addCanteenVisible,company_id:e.company_id,isEdit:e.isEdit,formdata:e.editForm,editDinnerList:e.editDinnersList,editAccount:e.editAccount,machineList:e.machineList,modules:e.modules},on:{closeAdd:e._cancelCanteen,updateMachineTable:function(t,n){return e.getMachineList(t,n)},updateCanteenList:e.getComsumptionLoc}}),n("add-shop-dialog",{attrs:{visible:e.addShopVisible,dialogTitle:e.shopDialogTitle,company_id:e.company_id,isEdit:e.isEdit,formdata:e.editForm,machineList:e.machineList},on:{closeDialog:e.closeShopDialog,updateMachineTable:function(t,n){return e.getMachineList(t,n)}}}),n("edit-enterprise-dialog",{attrs:{visible:e.editEnterpriseDialogVisible,modules:e.modules,company_id:e.company_id},on:{closeDialog:e.closeEditEnterprise}})],1)}),[],!1,null,"34653581",null));t.default=B.exports}}]);