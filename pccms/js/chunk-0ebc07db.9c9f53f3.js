(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ebc07db"],{"2f0c":function(e,t,a){"use strict";var n=a("7361");a.n(n).a},"333d":function(e,t,a){"use strict";var n={name:"Pagination",props:{small:{type:Boolean,default:!1},total:{required:!0,type:Number},page:{type:Number,default:1},background:{type:Boolean,default:!0},layout:{type:String,default:"prev, pager, next"},pageSize:{type:Number,default:10}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}}},methods:{handleClickPage:function(e){this.$emit("pagination",e)}}},i=(a("2f0c"),a("2877")),s=Object(i.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{small:e.small,background:e.background,total:e.total,layout:e.layout,"page-size":e.pageSize,"current-page":e.currentPage},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handleClickPage}})],1)}),[],!1,null,null,null);t.a=s.exports},"4d10":function(e,t,a){"use strict";var n=a("c9ac");a.n(n).a},6108:function(e,t,a){"use strict";var n=a("bd2b");a.n(n).a},6715:function(e,t,a){"use strict";a.r(t);var n=a("a34a"),i=a.n(n),s=a("365c"),c=a("84b8"),r=a("333d"),o=a("575f"),l=a("4360");function u(e,t,a,n,i,s,c){try{var r=e[s](c),o=r.value}catch(e){return void a(e)}r.done?t(o):Promise.resolve(o).then(n,i)}function d(e){return function(){var t=this,a=arguments;return new Promise((function(n,i){var s=e.apply(t,a);function c(e){u(s,n,i,c,r,"next",e)}function r(e){u(s,n,i,c,r,"throw",e)}c(void 0)}))}}var h,p,m,f,g,b,k,v={components:{ShowModules:c.a,Pagination:r.a},data:function(){return{grade:l.a.getters.grade,detailDialogVisible:!1,company_id:"",companyOptions:[],companyList:[],canteenList:[],machineList:[],modules:[],detailForm:{},queryForm:{name:"",created_time:""},staffs:100,current_page:1,size:10,total:10,machine_page:1,machine_size:3,machine_total:10}},filters:{handleGrades:function(e){return""==e?"":"".concat(["零","一","二","三","四","五","六","七","八","九"][e],"级企业")},showState:function(e){return 1===e?"正常":"异常"},showMachineType:function(e){return"canteen"===e?"饭堂":"小卖部"}},created:function(){this.fetchList(),this.getCompaniesList()},computed:{companiesVisible:function(){return 3!==this.grade}},methods:{fetchList:(k=d(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||1,e.next=3,s.a.get("http://canteen.tonglingok.com/api/v1/companies?page=".concat(t,"&size=").concat(this.size),this.queryForm);case 3:"ok"===(a=e.sent).msg&&(this.companyList=Array.from(a.data.data),this.total=a.data.total,this.current_page=a.data.current_page);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)}),getCompaniesList:(b=d(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("http://canteen.tonglingok.com/api/v1/admin/companies");case 2:t=e.sent,this.companyOptions=Array.from(Object(o.a)(t.data));case 4:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)}),openDetailDialog:(g=d(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.company_id=t.id,a=t.id,this.canteenList=Array.from(t.canteen),e.next=5,this.getModules(a);case 5:return e.next=7,this.getCompanyDetail(a);case 7:return e.next=9,this.getCompanyMachine();case 9:this.detailDialogVisible=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)}),closeDetailDialog:function(){this.detailDialogVisible=!1},getCompanyDetail:(f=d(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("http://canteen.tonglingok.com/api/v1/canteens/company?company_id=".concat(t));case 2:return"ok"===(a=e.sent).msg&&(this.staffs=a.data.staffs),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)}),getModules:(m=d(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("http://canteen.tonglingok.com/api/v1/modules/canteen/withSystem",{c_id:t});case 2:return"ok"===(a=e.sent).msg&&(this.modules=Array.from(a.data)),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)}),getCompanyMachine:(p=d(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("http://canteen.tonglingok.com/api/v1/machines/company",{company_id:this.company_id,page:t||1,size:this.machine_size});case 2:return"ok"===(a=e.sent).msg&&(this.machineList=Array.from(a.data.data),this.machine_total=a.data.total),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)}),_delete:(h=d(i.a.mark((function e(t){var a,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.id,this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(d(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.post("http://canteen.tonglingok.com/api/v1/canteen/deleteMachine",{id:a});case 2:if("ok"!==e.sent.msg){e.next=7;break}return n.$message({type:"success",message:"删除成功!"}),e.next=7,n.getCompanyMachine(n.company_id);case 7:case"end":return e.stop()}}),e)})))).catch((function(){n.$message({type:"info",message:"已取消删除"})}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})}},y=(a("6108"),a("2877")),_=Object(y.a)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"enterprise-details"},[a("div",{staticClass:"nav-title"},[e._v("企业明细")]),a("el-divider"),a("div",{staticClass:"main"},[a("div",{staticClass:"main-header"},[a("el-form",{ref:"queryForm",attrs:{inline:!0,"label-position":"left",model:e.queryForm}},[e.companiesVisible?a("el-form-item",{attrs:{label:"公司",prop:"name","label-width":"60px"}},[a("el-select",{model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}},e._l(e.companyOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"时间",prop:"create_time","label-width":"50px"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"选择日期"},model:{value:e.queryForm.create_time,callback:function(t){e.$set(e.queryForm,"create_time",t)},expression:"queryForm.create_time"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:e.fetchList}},[e._v("查询")])],1)],1),a("div",{staticClass:"main-content"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.companyList}},[a("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"200px"}}),a("el-table-column",{attrs:{label:"公司级别",prop:"grade"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("handleGrades")(t.row.grade)))])]}}])}),a("el-table-column",{attrs:{label:"归属企业"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.parent_name?t.row.parent_name:"无"))])]}}])}),a("el-table-column",{attrs:{label:"公司名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(){return e.openDetailDialog(t.row)}}},[e._v(e._s(t.row.name))])]}}])})],1),a("pagination",{attrs:{total:e.total,pageSize:e.size,currentPage:e.current_page},on:{pagination:e.fetchList}})],1)])],1),a("el-dialog",{attrs:{width:"50%",visible:e.detailDialogVisible,title:"企业明细",center:""},on:{"update:visible":function(t){e.detailDialogVisible=t},close:e.closeDetailDialog}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"lf-col"},[a("el-table",{staticClass:"canteen-table",attrs:{size:"mini",data:e.canteenList}},[a("el-table-column",{attrs:{label:"饭堂名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"}},[e._v(e._s(t.row.name))])]}}])})],1),a("p",{staticStyle:{padding:"5px 0"}},[a("el-tag",[e._v("企业人数："+e._s(e.staffs)+"人")])],1)],1)]),a("el-col",{attrs:{span:18}},[a("show-modules",{attrs:{modules:e.modules,disabled:!0}}),a("el-card",{staticClass:"box-card",attrs:{"body-style":"paddingBottom: 5px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("硬件列表")])]),a("el-table",{attrs:{data:e.machineList,size:"mini"}},[a("el-table-column",{attrs:{label:"设备类别"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("showMachineType")(t.row.machine_type)))])]}}])}),a("el-table-column",{attrs:{label:"设备序号",prop:"number"}}),a("el-table-column",{attrs:{label:"设备名称",prop:"name"}}),a("el-table-column",{attrs:{label:"硬件号",prop:"code"}}),a("el-table-column",{attrs:{label:"状态",prop:"state"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("showState")(t.row.state)))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e._delete(t.row)}}},[e._v("删除")])],1)]}}])})],1),a("pagination",{attrs:{pageSize:e.machine_size,currentPage:e.machine_page,small:!0,total:e.machine_total},on:{pagination:e.getCompanyMachine}})],1)],1)],1)],1)],1)}),[],!1,null,"4812c6be",null);t.default=_.exports},7361:function(e,t,a){},"84b8":function(e,t,a){"use strict";var n=a("575f");function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var s={props:["modules","isConfirm","disabled"],data:function(){return{title:"模块明细",addModulesIds:[],checkAll:{},modulesCheckbox:{},checkedModules:{},checkedWXAllModules:{},isIndeterminate:{},pcModules:[],allModules:[],WXModules:[],defaultModules:[],confirmed:!1}},watch:{modules:{handler:function(e){this.handleModules(e)},immediate:!0},isConfirm:{handler:function(e){this.confirmed=e}}},methods:{handleModules:function(e){var t=this,a=Object(n.c)(e);this.allModules=a,e.forEach((function(e){var a=e.id;t.checkAll=Object.assign({},t.checkAll,i({},a,!1)),t.isIndeterminate=Object.assign({},t.isIndeterminate,i({},a,!1)),t.checkedModules=Object.assign({},t.checkedModules,i({},a,[])),t.modulesCheckbox=Object.assign({},t.modulesCheckbox,i({},a,[]))})),this.pcModules=e.filter((function(e){return 1===e.type})),this.WXModules=e.filter((function(e){return 2===e.type}));var s=Object(n.c)(this.pcModules),c=Object(n.c)(this.WXModules);this.initCheckBox(s,this.modulesCheckbox,this.checkedModules,this.checkAll,this.isIndeterminate),this.initCheckBox(c,this.modulesCheckbox,this.checkedWXAllModules,this.checkAll,this.isIndeterminate),a.forEach((function(e){1===e.have&&t.defaultModules.push(e.id)}))},initCheckBox:function(e,t,a,n,i){var s=this;e.forEach((function(e){var c=e.id,r=e.parent_id;r&&t[r].push(c),1===e.have&&e.parent_id?(a[r].push(e.id),n[r]=a[r].length===t[r].length):1!==e.have||0!==r||e.items||(s.checkAll[c]=!0),r&&(i[r]=a[r].length>0&&a[r].length<t[r].length)}))},handleCheckAllChange:function(e,t){this.checkedModules[""+t]=e?this.modulesCheckbox[""+t]:[],this.isIndeterminate[""+t]=!1},handleCheckedModulesChange:function(e,t){var a=e.length;this.checkAll[""+t]=a===this.modulesCheckbox[""+t].length,this.isIndeterminate[""+t]=a>0&&a<this.modulesCheckbox[""+t].length},confirm:function(){this.confirmed=!0,this.$emit("getModules",this.checkedModules,this.checkAll)}}},c=(a("4d10"),a("2877")),r=Object(c.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(e.title))])]),a("div",[e._v("PC端")]),e._l(e.pcModules,(function(t){return a("div",{key:t.create_time},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id],disabled:e.disabled},on:{change:function(a){return e.handleCheckAllChange(a,t.id)}},model:{value:e.checkAll[t.id],callback:function(a){e.$set(e.checkAll,t.id,a)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))]),a("el-checkbox-group",{staticStyle:{padding:"0 20px"},attrs:{disabled:e.disabled},on:{change:function(a){return e.handleCheckedModulesChange(a,t.id)}},model:{value:e.checkedModules[t.id],callback:function(a){e.$set(e.checkedModules,t.id,a)},expression:"checkedModules[item.id]"}},e._l(t.items,(function(t){return a("el-checkbox",{key:t.create_time,attrs:{disabled:e.disabled,label:t.id}},[e._v(e._s(t.name))])})),1)],1)})),a("div",[e._v("微信端")]),e._l(e.WXModules,(function(t){return a("div",{key:t.create_time},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id],disabled:e.disabled},on:{change:function(a){return e.handleCheckAllChange(a,t.id)}},model:{value:e.checkAll[t.id],callback:function(a){e.$set(e.checkAll,t.id,a)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))])],1)})),a("div",{staticStyle:{textAlign:"center"}},[a("el-button",{attrs:{disabled:e.confirmed},on:{click:e.confirm}},[e._v("确定")])],1)],2)}),[],!1,null,"a3e51d62",null);t.a=r.exports},bd2b:function(e,t,a){},c9ac:function(e,t,a){}}]);