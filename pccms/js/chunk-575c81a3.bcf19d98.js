(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-575c81a3"],{"2f0c":function(t,e,n){"use strict";var a=n("7361");n.n(a).a},"30a8":function(t,e,n){"use strict";n.r(e);var a=n("a34a"),i=n.n(a),o=n("365c"),s=n("333d"),r=n("575f"),c=n("4360");function l(t,e,n,a,i,o,s){try{var r=t[o](s),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(a,i)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(a,i){var o=t.apply(e,n);function s(t){l(o,a,i,s,r,"next",t)}function r(t){l(o,a,i,s,r,"throw",t)}s(void 0)}))}}var d,m,p={components:{Pagination:s.a},data:function(){return{grade:c.a.getters.grade,editVisible:!1,editForm:{category:"",status:0,number:0},companyList:[],company_id:"",canteen_id:"",dinnerList:[],listObj:[{category:"",disabled:!1}],AddVisible:!1,isMoving:!0,detail:[],menuForm:{c_id:"",d_id:[],status:1,dinner_name:"",number:0,detail:[]},locationList:[],tableList:[],spanArr:[],position:0,current_page:1,size:2,total:10}},watch:{listObj:function(){}},created:function(){this.companiesVisible?this.getCompanies():this.getLocationList(0)},computed:{companiesVisible:function(){return 3!==this.grade}},methods:{getCompanies:function(){var t=this;o.a.get("http://canteen.tonglingok.com/api/v1/admin/companies").then((function(e){var n=e.data,a=[],i=Object(r.a)(n);i.forEach((function(t){var e=t.id;a.push(e)})),a=a.join(","),i.unshift({name:"全部",id:a}),t.companyList=i})).catch((function(t){return console.log(t)}))},getLocationList:function(t){var e=this;this.menuForm.c_id="",this.menuForm.dinner_id="",this.menuForm.m_id="",this.canteen_id="",isNaN(t)?(this.locationList=[],this.categoryList=[],this.dinnersList=[]):t?o.a.get("http://canteen.tonglingok.com/api/v1/canteens?company_id=".concat(t)).then((function(t){e.locationList=Object(r.d)(Array.from(t.data))})).catch((function(t){return console.log(t)})):o.a.get("http://canteen.tonglingok.com/api/v1/managerCanteens").then((function(t){e.locationList=Object(r.d)(Array.from(t.data))})).catch((function(t){return console.log(t)}))},getDinnersList:function(t){var e=this;o.a.get("http://canteen.tonglingok.com/api/v1/canteen/dinners?canteen_id=".concat(t)).then((function(t){e.dinnerList=Array.from(t.data)})).catch((function(t){return console.log(t)}))},removeInput:function(t){var e=this.listObj.indexOf(t);this.listObj.length;-1!==e&&(this.listObj.splice(e,1),this.detail.splice(e,1),this.menuForm.detail=JSON.stringify(this.detail))},addListObjItem:function(){var t=this.listObj.length;0!=t?this.listObj[t-1].category&&(this.listObj[t-1].disabled=!0,this.detail.push({category:this.listObj[t-1].category,count:this.menuForm.number,status:this.menuForm.status}),this.menuForm.detail=JSON.stringify(this.detail),this.listObj.push({category:"",disabled:!1})):this.listObj.push({category:"",disabled:!1})},closeNewMenu:function(){this.AddVisible=!1,this.listObj=[{category:"",disabled:!1}],this.dinnerList=[],this.menuForm={c_id:"",name:[],status:1,dinner_name:"",number:0,detail:[]}},addNewMenu:(m=u(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(this.menuForm),t.next=3,o.a.post("http://canteen.tonglingok.com/api/v1/menu/save",this.menuForm);case 3:"ok"===t.sent.msg&&(this.$message.success("操作成功"),this.detail=[],this.fetchTableList(),this.closeNewMenu());case 5:case"end":return t.stop()}}),t,this)}))),function(){return m.apply(this,arguments)}),changeStatus:function(){},fetchTableList:function(t){var e=this;t=t||1,o.a.get("http://canteen.tonglingok.com/api/v1/menus/company?company_id=".concat(this.company_id,"&canteen_id=").concat(this.canteen_id,"&size=").concat(this.size,"&page=").concat(t)).then((function(t){var n=Array.from(t.data.data);e.total=t.data.total;var a=[];n.forEach((function(t){t.dinner.length?t.dinner.forEach((function(e){e.menus.length?e.menus.forEach((function(n){a.push({grade:t.company.grade,company_name:t.company.name,company_id:t.company.id,canteen_name:t.name,canteen_id:t.id,category_name:e.name,category:n.category,dinner_id:e.id,menu_id:n.id,status:n.status,number:n.count})})):a.push({grade:t.company.grade,company_name:t.company.name,company_id:t.company.id,canteen_name:t.name,canteen_id:t.id,category_name:e.name,dinner_id:e.id})})):a.push({grade:t.company.grade,company_name:t.company.name,company_id:t.company.id,canteen_name:t.name})})),e.tableList=Array.from(a),e.rowspan(0,"grade"),e.rowspan(1,"company_name"),e.rowspan(2,"canteen_name"),e.rowspan(3,"category_name")})).catch((function(t){return console.log(t)}))},getCanteenDetail:function(t){var e=this;o.a.get("http://canteen.tonglingok.com/api/v1/menus/canteen?canteen_id=".concat(t)).then((function(t){return e.canteen_detail=Array.from(t.data)})).catch((function(t){return console.log(t)}))},_edit:function(t){this.editForm=Object.assign({},t),this.editVisible=!0},_editConfirm:(d=u(i.a.mark((function t(){var e,n,a,s,r,c,l,u,d;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.editForm,n=e.menu_id,a=e.status,s=e.number,r=e.category,c=e.canteen_id,l=e.dinner_id,u=[{id:n,status:a,category:r,count:s=1===a?s:"0"}],u=JSON.stringify(u),d={c_id:c,d_id:l,detail:u},t.next=7,o.a.post("http://canteen.tonglingok.com/api/v1/menu/save",d);case 7:"ok"===t.sent.msg&&(this.$message.success("操作成功!"),this.fetchTableList(),this._editClose());case 9:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)}),_editClose:function(){this.editVisible=!1,this.editForm={}},rowspan:function(t,e){var n=this;this.spanArr[t]=[],this.position=0,this.tableList.forEach((function(a,i){0===i?(n.spanArr[t].push(1),n.position=0):n.tableList[i][e]===n.tableList[i-1][e]?(n.spanArr[t][n.position]+=1,n.spanArr[t].push(0)):(n.spanArr[t].push(1),n.position=i)}))},objectSpanMethod:function(t){t.row,t.column;for(var e=t.rowIndex,n=t.columnIndex,a=0;a<4;a++)if(n===a){var i=this.spanArr[a][e];return{rowspan:i,colspan:i>0?1:0}}}}},h=n("2877"),f=Object(h.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"setting"},[n("div",{staticClass:"nav-title"},[t._v("菜单设置")]),n("el-divider"),n("div",{staticClass:"main"},[n("div",{staticClass:"main-header"},[t.companiesVisible?n("span",{staticClass:"content-header"},[t._v("公司：")]):t._e(),t.companiesVisible?n("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},on:{change:function(e){return t.getLocationList(t.company_id)}},model:{value:t.company_id,callback:function(e){t.company_id=e},expression:"company_id"}},t._l(t.companyList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._e(),n("span",{staticClass:"content-header"},[t._v("消费地点：")]),n("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},model:{value:t.canteen_id,callback:function(e){t.canteen_id=e},expression:"canteen_id"}},t._l(t.locationList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),n("el-button",{on:{click:function(e){t.AddVisible=!0}}},[t._v("新增")]),n("el-button",{on:{click:function(e){return t.fetchTableList(1)}}},[t._v("查询")])],1),n("div",{staticClass:"main-content"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableList,"span-method":t.objectSpanMethod}},[n("el-table-column",{attrs:{label:"公司级别",prop:"grade"}}),n("el-table-column",{attrs:{label:"公司名称",prop:"company_name"}}),n("el-table-column",{attrs:{label:"消费地点",prop:"canteen_name"}}),n("el-table-column",{attrs:{label:"餐类",prop:"category_name"}}),n("el-table-column",{attrs:{label:"菜类明细",prop:"category"}}),n("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-radio-group",{attrs:{disabled:""},model:{value:e.row.status,callback:function(n){t.$set(e.row,"status",n)},expression:"scope.row.status"}},[n("el-radio",{attrs:{label:1}},[t._v("固定")]),n("el-radio",{attrs:{label:2}},[t._v("动态")])],1)]}}])}),n("el-table-column",{attrs:{label:"可选菜品",prop:"number"}}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{staticStyle:{margin:"2px"},attrs:{size:"mini"},on:{click:function(n){return t._edit(e.row)}}},[t._v("编辑")]),n("el-button",{staticStyle:{margin:"2px"},attrs:{size:"mini",type:"danger"},on:{click:function(n){return t._delete(e.row)}}},[t._v("Delete")])]}}])})],1),n("pagination",{attrs:{total:t.total,pageSize:t.size,currentPage:t.current_page},on:{pagination:t.fetchTableList}})],1)]),n("el-dialog",{attrs:{visible:t.AddVisible,title:"新增菜单"},on:{"update:visible":function(e){t.AddVisible=e},close:t.closeNewMenu}},[n("el-form",{ref:"addMenuForm",attrs:{model:t.menuForm,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"饭堂"}},[n("el-select",{attrs:{placeholder:"请选择"},on:{change:t.getDinnersList},model:{value:t.menuForm.c_id,callback:function(e){t.$set(t.menuForm,"c_id",e)},expression:"menuForm.c_id"}},t._l(t.locationList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),n("el-form-item",{attrs:{label:"餐次"}},[n("el-select",{model:{value:t.menuForm.d_id,callback:function(e){t.$set(t.menuForm,"d_id",e)},expression:"menuForm.d_id"}},t._l(t.dinnerList,(function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1),n("el-form-item",{attrs:{label:"菜类"}},[t._l(t.listObj,(function(e,a){return n("div",{key:a,staticStyle:{margin:"5px 0"}},[n("el-input",{staticStyle:{width:"150px"},attrs:{disabled:e.disabled},model:{value:e.category,callback:function(n){t.$set(e,"category",n)},expression:"item.category"}}),n("el-button",{staticStyle:{marginLeft:"5px"},attrs:{icon:"el-icon-delete"},on:{click:function(n){return n.preventDefault(),t.removeInput(e)}}})],1)})),n("el-button",{on:{click:t.addListObjItem}},[t._v("添加")])],2),n("el-form-item",{attrs:{label:"选菜数量状态"}},[n("el-radio-group",{on:{change:t.changeStatus},model:{value:t.menuForm.status,callback:function(e){t.$set(t.menuForm,"status",e)},expression:"menuForm.status"}},[n("el-radio",{attrs:{label:1}},[t._v("固定")]),n("el-radio",{attrs:{label:2}},[t._v("动态")])],1)],1),1===t.menuForm.status?n("el-form-item",{attrs:{label:"数量"}},[n("el-input",{model:{value:t.menuForm.number,callback:function(e){t.$set(t.menuForm,"number",e)},expression:"menuForm.number"}})],1):t._e()],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.closeNewMenu}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.addNewMenu}},[t._v("确 定")])],1)],1),n("el-dialog",{attrs:{visible:t.editVisible,width:"30%",title:"编辑菜单",center:""},on:{"update:visible":function(e){t.editVisible=e}}},[n("el-form",{attrs:{model:t.editForm,"label-width":"60px"}},[n("el-form-item",{attrs:{label:"菜类",prop:"category"}},[n("el-input",{model:{value:t.editForm.category,callback:function(e){t.$set(t.editForm,"category",e)},expression:"editForm.category"}})],1),n("el-form-item",{attrs:{label:"状态",prop:"status"}},[n("el-radio-group",{model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[n("el-radio",{attrs:{label:1}},[t._v("固定")]),n("el-radio",{attrs:{label:2}},[t._v("动态")])],1)],1),1===t.editForm.status?n("el-form-item",{attrs:{label:"数量",prop:"number"}},[n("el-input",{model:{value:t.editForm.number,callback:function(e){t.$set(t.editForm,"number",e)},expression:"editForm.number"}})],1):t._e()],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t._editClose}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t._editConfirm}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,null,null);e.default=f.exports},"333d":function(t,e,n){"use strict";var a={name:"Pagination",props:{small:{type:Boolean,default:!1},total:{required:!0,type:Number},page:{type:Number,default:1},background:{type:Boolean,default:!0},layout:{type:String,default:"prev, pager, next"},pageSize:{type:Number,default:10}},computed:{currentPage:{get:function(){return this.page},set:function(t){this.$emit("update:page",t)}}},methods:{handleClickPage:function(t){this.$emit("pagination",t)}}},i=(n("2f0c"),n("2877")),o=Object(i.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pagination-container"},[n("el-pagination",{attrs:{small:t.small,background:t.background,total:t.total,layout:t.layout,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"current-change":t.handleClickPage}})],1)}),[],!1,null,null,null);e.a=o.exports},7361:function(t,e,n){}}]);