(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c877596c"],{5546:function(t,e,i){"use strict";var a=i("9f81");i.n(a).a},"9f81":function(t,e,i){},ddbe:function(t,e,i){"use strict";i.r(e);var a=i("365c"),s={props:{title:{required:!0,type:String},visible:{type:Boolean},editData:Object,reivseParam:Object,disabled:{type:Boolean,default:!1},state:String},data:function(){return{isOpen:this.visible,companyList:[],formdata:{},dialogVisible:!1,dialogImageUrl:"",limit:1,param:{},requiredParam:{},fileList:[]}},methods:{handleClose:function(){this.$emit("closeDialog",!1),this.formdata={},this.fileList=[]},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleRemove:function(t,e){},handleSuccess:function(t,e,i){200===t.code&&(this.formdata.image=t.data.url,console.log(e))},handleClick:function(){"revise"===this.state?(this.requiredParam=Object.assign({},this.param,this.formdata),this.$emit("confirm",this.requiredParam),this.formdata={},this.fileList=[]):"add"===this.state&&(this.$emit("confirm",this.formdata),this.formdata={})},initImageUrl:function(){this.fileList=[];var t=Object.assign({},this.formdata);t.url=t.image,delete t.image,this.fileList.push(t)}},watch:{visible:function(t){this.formdata=Object.assign({},this.formdata,this.editData),this.isOpen=t,this.visible&&"revise"===this.state&&this.initImageUrl()},reivseParam:function(t){this.param=Object.assign({},this.param,this.reivseParam)}}},o=i("2877"),n=Object(o.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{visible:t.isOpen,title:t.title},on:{"update:visible":function(e){t.isOpen=e},close:t.handleClose}},[i("el-form",{attrs:{"label-width":"80px"}},[i("el-form-item",{attrs:{label:"商品名称"}},[i("el-input",{model:{value:t.formdata.name,callback:function(e){t.$set(t.formdata,"name",e)},expression:"formdata.name"}})],1),i("el-form-item",{attrs:{label:"菜品单位"}},[i("el-input",{model:{value:t.formdata.unit,callback:function(e){t.$set(t.formdata,"unit",e)},expression:"formdata.unit"}})],1),i("el-form-item",{attrs:{label:"菜品单价"}},[i("el-input",{model:{value:t.formdata.price,callback:function(e){t.$set(t.formdata,"price",e)},expression:"formdata.price"}})],1),i("el-form-item",{attrs:{label:"库存"}},[t.formdata.stock?i("el-input",{attrs:{disabled:t.disabled},model:{value:t.formdata.stock,callback:function(e){t.$set(t.formdata,"stock",e)},expression:"formdata.stock"}}):i("el-input",{attrs:{disabled:t.disabled},model:{value:t.formdata.count,callback:function(e){t.$set(t.formdata,"count",e)},expression:"formdata.count"}})],1),i("el-form-item",{attrs:{label:"图片"}},[i("el-upload",{attrs:{action:"http://canteen.tonglingok.comhttp://canteen.tonglingok.com/api/v1/image/upload","list-type":"picture-card",name:"image",limit:t.limit,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"file-list":t.fileList}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.handleClick}},[t._v("确 定")])],1)],1)}),[],!1,null,"221d5a1a",null).exports,l={data:function(){return{supplier_id:"",supplierList:[],category_id:"",categoryList:[],addForm:{name:"",price:"",unit:"",count:"",image:""},reviseForm:{name:"",price:"",unit:"",stock:"",image:""},reviseFormTitle:"编辑商品",reviseVisible:!1,reivseParam:{},storageFormVisible:!1,storageCount:"",currentProductId:"",total:2,tabledata:[],addVisible:!1,addFormTitle:"新增商品"}},components:{ReviseDialog:n,AddDialog:n},created:function(){this.getSupplierList(),this.getCategoryList(),this.fetchTableList()},methods:{sendPostRequest:function(t,e){var i=this;a.a.post(t,e).then((function(t){i.sendMessage(t.msg),i.fetchTableList()})).catch((function(t){return console.log(t)}))},sendMessage:function(t){"ok"===t?this.$message({type:"success",message:"操作成功!"}):this.$message({type:"info",message:"操作失败"})},changeState:function(t,e){this.sendPostRequest("http://canteen.tonglingok.com/api/v1/shop/product/handel",{id:t,state:e})},getSupplierList:function(){var t=this;this.supplier_id="",a.a.get("http://canteen.tonglingok.com/api/v1/company/suppliers").then((function(e){t.supplierList=e.data,t.supplierList.unshift({id:0,name:"全部"})})).catch((function(t){return console.log(t)}))},getCategoryList:function(){var t=this;this.category_id="",a.a.get("http://canteen.tonglingok.com/api/v1/company/categories?&page=1&size=10").then((function(e){t.categoryList=e.data,t.categoryList.unshift({id:0,name:"全部"})})).catch((function(t){return console.log(t)}))},fetchTableList:function(){var t=this;a.a.get("http://canteen.tonglingok.com/api/v1/shop/cms/products?supplier_id=".concat(this.supplier_id,"&category_id=").concat(this.category_id,"&page=1&size=10")).then((function(e){t.tabledata=Array.from(e.data.data),t.total=e.data.total})).catch((function(t){return console.log(t)}))},getSummaries:function(t){var e=[];return e[0]="合计",e[7]=this.total+"种",e},handleEdit:function(t,e){this.reviseVisible=!0,this.reviseForm={name:e.name,price:e.price,unit:e.unit,stock:e.stock,image:e.image},this.reivseParam={id:e.product_id,supplier_id:this.supplier_id,category_id:this.category_id}},handleAdd:function(){this.addVisible=!0},closeReviseDialog:function(t){this.reviseVisible=t},confirmRevise:function(t){this.reviseVisible=!1,this.sendPostRequest("http://canteen.tonglingok.com/api/v1/shop/product/update",t)},closeAddDialog:function(t){this.addVisible=t},confirmAdd:function(t){var e={};Object.assign(e,{supplier_id:this.supplier_id,category_id:this.category_id},t),this.sendPostRequest("http://canteen.tonglingok.com/api/v1/shop/product/save",e),this.addVisible=!1},storage:function(t){this.storageFormVisible=!0,this.currentProductId=t.product_id},cancelStorage:function(){this.storageFormVisible=!1,this.storageCount=""},confirmStorage:function(){this.storageFormVisible=!1,this.sendPostRequest("http://canteen.tonglingok.com/api/v1/shop/stock/save",{product_id:this.currentProductId,count:this.storageCount}),this.storageCount=""},withdraw:function(t,e){var i=this;this.$confirm("请问确定下架该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.changeState(e.product_id,2)})).catch((function(t){}))},deleteGoods:function(t,e){var i=this;this.$confirm("请问确定删除该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.changeState(e.product_id,3)})).catch((function(t){}))},upbuild:function(t,e){var i=this;this.$confirm("请问确定上架该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.changeState(e.product_id,1)})).catch((function(t){}))}}},r=(i("5546"),Object(o.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"manage"},[i("div",{staticClass:"nav-title"},[t._v("商品管理")]),i("el-divider"),i("div",{staticClass:"main"},[i("div",{staticClass:"main-header"},[i("span",{staticClass:"content-header"},[t._v("供应商：")]),i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},model:{value:t.supplier_id,callback:function(e){t.supplier_id=e},expression:"supplier_id"}},t._l(t.supplierList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),i("span",{staticClass:"content-header"},[t._v("类型：")]),i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},model:{value:t.category_id,callback:function(e){t.category_id=e},expression:"category_id"}},t._l(t.categoryList,(function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),i("el-button",{attrs:{type:"primary"},on:{click:t.fetchTableList}},[t._v("查询")]),i("el-button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("增加")])],1),i("div",{staticClass:"main-content"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tabledata,"show-summary":"",border:"","summary-method":t.getSummaries}},[i("el-table-column",{attrs:{label:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{height:"100px"},attrs:{src:t.row.image,alt:t.row.name,srcset:""}})])]}}])}),i("el-table-column",{attrs:{label:"名称",prop:"name"}}),i("el-table-column",{attrs:{label:"类型",prop:"category"}}),i("el-table-column",{attrs:{label:"单位",prop:"unit"}}),i("el-table-column",{attrs:{label:"单价",prop:"price"}}),i("el-table-column",{attrs:{label:"供应商",prop:"supplier"}}),i("el-table-column",{attrs:{label:"库存",prop:"stock"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return t.deleteGoods(e.$index,e.row)}}},[t._v("删除")]),2===e.row.state?i("el-button",{staticClass:"option",attrs:{size:"mini"},on:{click:function(i){return t.upbuild(e.$index,e.row)}}},[t._v("上架")]):t._e(),1===e.row.state?i("el-button",{staticClass:"option",attrs:{size:"mini"},on:{click:function(i){return t.withdraw(e.$index,e.row)}}},[t._v("下架")]):t._e(),i("el-button",{staticClass:"option",attrs:{size:"mini"},on:{click:function(i){return t.storage(e.row)}}},[t._v("入库")])]}}])})],1)],1)])],1),i("add-dialog",{attrs:{title:t.addFormTitle,editData:t.addForm,visible:t.addVisible,state:"add"},on:{closeDialog:t.closeAddDialog,confirm:t.confirmAdd}}),i("revise-dialog",{attrs:{title:t.reviseFormTitle,editData:t.reviseForm,visible:t.reviseVisible,disabled:!0,state:"revise",reivseParam:t.reivseParam},on:{closeDialog:t.closeReviseDialog,confirm:t.confirmRevise}}),i("el-dialog",{attrs:{title:"入库",visible:t.storageFormVisible},on:{"update:visible":function(e){t.storageFormVisible=e}}},[i("el-form",[i("el-form-item",{attrs:{label:"入库数量","label-width":"80px"}},[i("el-input",{model:{value:t.storageCount,callback:function(e){t.storageCount=e},expression:"storageCount"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancelStorage}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.confirmStorage}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,null,null));e.default=r.exports}}]);