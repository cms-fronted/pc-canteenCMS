(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-cd4383b2"],{"248c":function(e,t,n){},a02c:function(e,t,n){"use strict";n.r(t);var i=n("a34a"),o=n.n(i),r=n("575f"),a=n("365c"),s=n("4360");function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){d(r,i,o,a,s,"next",e)}function s(e){d(r,i,o,a,s,"throw",e)}a(void 0)}))}}var p,g,f,h,b,_,y,v={data:function(){return{grade:s.a.getters.grade,settingDialogVisible:!1,changeSettingVisible:!1,addCountVisible:!1,isEdit:!1,queryForm:{company_id:"",c_id:""},canteenList:[],dialogCanteenList:[],companiesList:[],roleTypeList:[],newSettingForm:{company_id:"",c_id:"",t_id:"",unordered_meals:""},editSettingForm:{},detail:[],detailStrategy:[],countDetailForm:{},orderingMealForm:{money:"",sub_money:""},noMealOrderedForm:{money:"",sub_money:""},unOrderedMealForm:{money:"",sub_money:""},current_page:1,budgetList:[],dataList:[],spanArr:[],position:0}},mounted:function(){this.getCompanies(),this.getRoleType()},filters:{consumptionType:function(e){switch(e){case"ordering_meals":return"订餐就餐";case"no_meals_ordered":return"订餐未就餐";case"unordered_meals":return"未订餐就餐"}}},computed:{companiesVisible:function(){return 3!==this.grade}},created:function(){this.companiesVisible?this.getCompanies():this.getCanteenList()},methods:u({getCompanies:(y=m(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.get("http://canteen.tonglingok.com/api/v1/admin/companies").then((function(e){var n=e.data;t.companiesList=Object(r.a)(n),t.queryForm.c_id=null,t.canteenList=[]})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)}),getCanteenList:(_=m(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,a.a.get("http://canteen.tonglingok.com/api/v1/canteens?company_id=".concat(t)).then((function(e){n.canteenList=Array.from(e.data)})).catch((function(e){return console.log(e)}));case 3:e.next=7;break;case 5:return e.next=7,a.a.get("http://canteen.tonglingok.com/api/v1/managerCanteens").then((function(e){n.canteenList=Array.from(e.data)})).catch((function(e){return console.log(e)}));case 7:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)}),getDialogCanteenList:(b=m(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.newSettingForm.c_id="",this.newSettingForm.t_id="",e.next=4,a.a.get("http://canteen.tonglingok.com/api/v1/company/consumptionLocation?company_id=".concat(t)).then((function(e){n.dialogCanteenList=Array.from(e.data.canteen)})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)}),queryList:(h=m(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.get("http://canteen.tonglingok.com/api/v1/canteen/consumptionStrategy",{c_id:this.queryForm.c_id,page:this.current_page,size:3}).then((function(e){t.budgetList=Array.from(e.data),t.handleData(),t.rowspan(0,"canteen"),t.rowspan(1,"role"),t.rowspan(2,"dinner")}));case 2:e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)}),getRoleType:(f=m(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.get("http://canteen.tonglingok.com/api/v1/role/types").then((function(e){return t.roleTypeList=Array.from(e.data.data)}));case 2:case"end":return e.stop()}}),e)}))),function(){return f.apply(this,arguments)}),_addNewSetting:(g=m(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isEdit){e.next=6;break}return this.newSettingForm.detail=JSON.stringify(this.newSettingForm.detail),e.next=4,a.a.post("http://canteen.tonglingok.com/api/v1/canteen/consumptionStrategy/update",this.newSettingForm).then((function(e){"ok"===e.msg&&t.closeSettingDialog()})).catch((function(e){return console.log(e)}));case 4:e.next=8;break;case 6:return e.next=8,a.a.post("http://canteen.tonglingok.com/api/v1/canteen/consumptionStrategy/save",this.newSettingForm).then((function(e){"ok"===e.msg&&(t.$message.success("添加成功"),t.queryList()),t.closeSettingDialog()})).catch((function(e){return console.log(e)}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)}),closeSettingDialog:function(){this.settingDialogVisible=!1,this.isEdit=!1,this.$refs.newSettingForm.resetFields()},_editSetting:function(e){var t=this,n=this.budgetList.filter((function(t){return t.id===e.id}))[0],i=n.detail;this.isEdit=!0,this.editSettingForm=Object.assign({},n),i?(this.detail=i,i&&i.forEach((function(e){e.strategy.forEach((function(n){t.detailStrategy.push({number:e.number,status:n.status,money:n.money,sub_money:n.sub_money})}))})),this.changeSettingVisible=!0):this.changeSettingVisible=!0},_closeEditSettingDialog:function(){this.$refs.editSettingForm.resetFields(),this.detail=[],this.detailStrategy=[],this.isEdit=!1,this.changeSettingVisible=!1},_openCountDialog:function(){this.addCountVisible=!0},_closeCountDialog:function(){this.addCountVisible=!1,this.orderingMealForm={},this.noMealOrderedForm={},this.unOrderedMealForm={}},_changeDetail:function(){var e=this,t=this.detail.length+1,n=[c({number:t,status:"ordering_meals"},this.orderingMealForm),c({number:t,status:"no_meals_ordered"},this.noMealOrderedForm),c({number:t,status:"unordered_meals"},this.unOrderedMealForm)];n.forEach((function(t){return e.detailStrategy.push(t)})),this.detail.push({number:t,strategy:n}),this._closeCountDialog()},changeSetting:(p=m(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.editSettingForm.consumption_count=this.detail.length,this.editSettingForm.detail=JSON.stringify(this.detail),e.next=4,a.a.post("http://canteen.tonglingok.com/api/v1/canteen/consumptionStrategy/update",this.editSettingForm).then((function(e){"ok"===e.msg&&(t.$message.success("修改成功"),t.queryList()),t._closeEditSettingDialog()})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)}),objectSpanMethod:function(e){var t=e.row,n=e.column;e.rowIndex,e.columnIndex;if("人员类型"==n.label)return{rowspan:t.detail[0].strategy.length,colspan:1}},handleData:function(){var e=[];this.budgetList.forEach((function(t){t.detail?t.detail.forEach((function(n){n.strategy.forEach((function(i){e.push({id:t.id,canteen:t.canteen.name,canteen_id:t.canteen.id,dinner:t.dinner.name,dinner_id:t.dinner.id,role:t.role.name,role_id:t.role.id,money:i.money,status:i.status,sub_money:i.sub_money,num_type:n.number,consumption_count:t.detail.length,unordered_meals:t.unordered_meals,ordered_count:t.ordered_count})}))})):e.push({id:t.id,canteen:t.canteen.name,canteen_id:t.canteen.id,dinner:t.dinner.name,dinner_id:t.dinner.id,role:t.role.name,role_id:t.role.id,consumption_count:t.consumption_count,unordered_meals:t.unordered_meals,ordered_count:t.ordered_count})})),this.dataList=e},rowspan:function(e,t){var n=this;this.spanArr[e]=[],this.position=0,this.dataList.forEach((function(i,o){0===o?(n.spanArr[e].push(1),n.position=0):n.dataList[o][t]===n.dataList[o-1][t]?(n.spanArr[e][n.position]+=1,n.spanArr[e].push(0)):(n.spanArr[e].push(1),n.position=o)}))}},"objectSpanMethod",(function(e){e.row,e.column;for(var t=e.rowIndex,n=e.columnIndex,i=0;i<3;i++)if(n===i){var o=this.spanArr[i][t];return{rowspan:o,colspan:o>0?1:0}}}))},w=(n("d421"),n("2877")),S=Object(w.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"strategy"},[n("div",{staticClass:"nav-title"},[e._v("消费策略设置")]),n("el-divider"),n("div",{staticClass:"main"},[n("div",{staticClass:"main-header"},[n("el-form",{attrs:{model:e.queryForm,inline:!0,"label-width":"60px"}},[e.companiesVisible?n("el-form-item",{attrs:{label:"公司"}},[n("el-select",{on:{change:e.getCanteenList},model:{value:e.queryForm.company_id,callback:function(t){e.$set(e.queryForm,"company_id",t)},expression:"queryForm.company_id"}},e._l(e.companiesList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),n("el-form-item",{attrs:{label:"饭堂"}},[n("el-select",{model:{value:e.queryForm.c_id,callback:function(t){e.$set(e.queryForm,"c_id",t)},expression:"queryForm.c_id"}},e._l(e.canteenList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),n("el-button",{attrs:{disabled:!e.queryForm.c_id},on:{click:e.queryList}},[e._v("查询")]),n("el-button",{on:{click:function(t){e.settingDialogVisible=!0}}},[e._v("新增")])],1)],1)]),n("div",{staticClass:"main-cotent"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,"span-method":e.objectSpanMethod,size:"mini",border:""}},[n("el-table-column",{attrs:{prop:"canteen",label:"消费地点",width:"120px"}}),n("el-table-column",{attrs:{prop:"role",label:"人员类型",width:"120px"}}),n("el-table-column",{attrs:{prop:"dinner",label:"餐饮",width:"120px"}}),n("el-table-column",{attrs:{label:"未定餐允许就餐",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v("\n            "+e._s(1===t.row.unordered_meals?"允许":"拒绝")+"\n          ")])]}}])}),n("el-table-column",{attrs:{prop:"consumption_count",label:"允许消费次数",width:"150px"}}),n("el-table-column",{attrs:{prop:"ordered_count",label:"订餐数量",width:"100px"}}),n("el-table-column",{attrs:{prop:"status",label:"消费状态",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e._f("consumptionType")(t.row.status)))])]}}])}),n("el-table-column",{attrs:{prop:"num_type",label:"次数类型",width:"80px"}}),n("el-table-column",{attrs:{label:"金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{staticStyle:{marginRight:"5px"},attrs:{type:"info",size:"small",effect:"dark"}},[e._v("标准金额:"+e._s(t.row.money)+"元")]),n("el-tag",{attrs:{type:"warning",size:"small",effect:"dark"}},[e._v("附加金额:"+e._s(t.row.money)+"元")])]}}])}),n("el-table-column",{attrs:{label:"操作",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e._editSetting(t.row)}}},[e._v("编辑")])],1)]}}])})],1)],1),n("el-dialog",{attrs:{visible:e.settingDialogVisible,width:"30%",title:"新增策略"},on:{"update:visible":function(t){e.settingDialogVisible=t},close:e.closeSettingDialog}},[n("el-form",{ref:"newSettingForm",attrs:{model:e.newSettingForm,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"公司",prop:"company_id"}},[n("el-select",{on:{change:e.getDialogCanteenList},model:{value:e.newSettingForm.company_id,callback:function(t){e.$set(e.newSettingForm,"company_id",t)},expression:"newSettingForm.company_id"}},e._l(e.companiesList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),n("el-form-item",{attrs:{label:"饭堂",prop:"c_id"}},[n("el-select",{model:{value:e.newSettingForm.c_id,callback:function(t){e.$set(e.newSettingForm,"c_id",t)},expression:"newSettingForm.c_id"}},e._l(e.dialogCanteenList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),n("el-form-item",{attrs:{label:"人员类型",prop:"t_id"}},[n("el-select",{model:{value:e.newSettingForm.t_id,callback:function(t){e.$set(e.newSettingForm,"t_id",t)},expression:"newSettingForm.t_id"}},e._l(e.roleTypeList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),n("el-form-item",{attrs:{label:"未订餐就餐",prop:"unordered_meals"}},[n("el-radio-group",{model:{value:e.newSettingForm.unordered_meals,callback:function(t){e.$set(e.newSettingForm,"unordered_meals",t)},expression:"newSettingForm.unordered_meals"}},[n("el-radio",{attrs:{label:1}},[e._v("允许")]),n("el-radio",{attrs:{label:2}},[e._v("拒绝")])],1)],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeSettingDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._addNewSetting}},[e._v("确 定")])],1)],1),n("el-dialog",{attrs:{visible:e.changeSettingVisible,title:"修改策略",width:"40%"},on:{"update:visible":function(t){e.changeSettingVisible=t},close:e._closeEditSettingDialog}},[n("el-dialog",{attrs:{width:"40%","append-to-body":"",visible:e.addCountVisible},on:{"update:visible":function(t){e.addCountVisible=t},close:e._closeCountDialog}},[n("el-form",{attrs:{model:e.countDetailForm}},[n("el-form-item",{attrs:{label:"次数类型"}},[n("p",[e._v("第"+e._s(e.detail.length+1)+"次")])]),n("el-form-item",{attrs:{label:"订餐就餐"}},[n("span",[e._v("\n            标准金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.orderingMealForm.money,callback:function(t){e.$set(e.orderingMealForm,"money",t)},expression:"orderingMealForm.money"}})],1),n("span",[e._v("\n            附加金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.orderingMealForm.sub_money,callback:function(t){e.$set(e.orderingMealForm,"sub_money",t)},expression:"orderingMealForm.sub_money"}})],1)]),n("el-form-item",{attrs:{label:"订餐未就餐"}},[n("span",[e._v("\n            标准金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.noMealOrderedForm.money,callback:function(t){e.$set(e.noMealOrderedForm,"money",t)},expression:"noMealOrderedForm.money"}})],1),n("span",[e._v("\n            附加金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.noMealOrderedForm.sub_money,callback:function(t){e.$set(e.noMealOrderedForm,"sub_money",t)},expression:"noMealOrderedForm.sub_money"}})],1)]),n("el-form-item",{attrs:{label:"未订餐就餐"}},[n("span",[e._v("\n            标准金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.unOrderedMealForm.money,callback:function(t){e.$set(e.unOrderedMealForm,"money",t)},expression:"unOrderedMealForm.money"}})],1),n("span",[e._v("\n            附加金额\n            "),n("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",type:"number"},model:{value:e.unOrderedMealForm.sub_money,callback:function(t){e.$set(e.unOrderedMealForm,"sub_money",t)},expression:"unOrderedMealForm.sub_money"}})],1)])],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e._closeCountDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._changeDetail}},[e._v("确 定")])],1)],1),n("el-form",{ref:"editSettingForm",attrs:{model:e.editSettingForm,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"未定餐就餐",prop:"unordered_meals"}},[n("el-radio-group",{model:{value:e.editSettingForm.unordered_meals,callback:function(t){e.$set(e.editSettingForm,"unordered_meals",t)},expression:"editSettingForm.unordered_meals"}},[n("el-radio",{attrs:{label:1}},[e._v("允许")]),n("el-radio",{attrs:{label:2}},[e._v("拒绝")])],1)],1),n("el-form-item",{attrs:{label:"订餐数量"}},[n("el-input",{staticStyle:{width:"100px"},attrs:{type:"number"},model:{value:e.editSettingForm.ordered_count,callback:function(t){e.$set(e.editSettingForm,"ordered_count",t)},expression:"editSettingForm.ordered_count"}})],1)],1),n("el-card",{staticClass:"box-card",attrs:{"body-style":"paddingBottom: 5px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("消费设置")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e._openCountDialog}},[e._v("添加次数")])],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.detailStrategy,height:"250"}},[n("el-table-column",{attrs:{label:"次数",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v("第"+e._s(t.row.number)+"次")])]}}])}),n("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e._f("consumptionType")(t.row.status)))])]}}])}),n("el-table-column",{attrs:{label:"金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{staticStyle:{marginRight:"5px"},attrs:{type:"info",size:"mini",effect:"dark"}},[e._v("标准:"+e._s(t.row.money)+"元")]),n("el-tag",{attrs:{type:"warning",size:"mini",effect:"dark"}},[e._v("附加:"+e._s(t.row.money)+"元")])]}}])})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e._closeEditSettingDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.changeSetting}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"977ea7f4",null);t.default=S.exports},d421:function(e,t,n){"use strict";var i=n("248c");n.n(i).a}}]);