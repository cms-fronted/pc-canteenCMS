(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-f6f3984a"],{"0043":function(e,t,n){},"2f0c":function(e,t,n){"use strict";var a=n("7361");n.n(a).a},"333d":function(e,t,n){"use strict";var a={name:"Pagination",props:{small:{type:Boolean,default:!1},total:{required:!0,type:Number},page:{type:Number,default:1},background:{type:Boolean,default:!0},layout:{type:String,default:"prev, pager, next"},pageSize:{type:Number,default:10}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}}},methods:{handleClickPage:function(e){this.$emit("pagination",e)}}},r=(n("2f0c"),n("2877")),o=Object(r.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pagination-container"},[n("el-pagination",{attrs:{small:e.small,background:e.background,total:e.total,layout:e.layout,"page-size":e.pageSize,"current-page":e.currentPage},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handleClickPage}})],1)}),[],!1,null,null,null);t.a=o.exports},"4d10":function(e,t,n){"use strict";var a=n("c9ac");n.n(a).a},"6b4b":function(e,t,n){"use strict";var a=n("0043");n.n(a).a},7361:function(e,t,n){},"84b8":function(e,t,n){"use strict";var a=n("575f");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o={props:["modules","isConfirm","disabled"],data:function(){return{title:"模块明细",addModulesIds:[],checkAll:{},modulesCheckbox:{},checkedModules:{},checkedWXAllModules:{},isIndeterminate:{},pcModules:[],allModules:[],WXModules:[],defaultModules:[],confirmed:!1}},watch:{modules:{handler:function(e){this.handleModules(e)},immediate:!0},isConfirm:{handler:function(e){this.confirmed=e}}},methods:{handleModules:function(e){var t=this,n=Object(a.c)(e);this.allModules=n,e.forEach((function(e){var n=e.id;t.checkAll=Object.assign({},t.checkAll,r({},n,!1)),t.isIndeterminate=Object.assign({},t.isIndeterminate,r({},n,!1)),t.checkedModules=Object.assign({},t.checkedModules,r({},n,[])),t.modulesCheckbox=Object.assign({},t.modulesCheckbox,r({},n,[]))})),this.pcModules=e.filter((function(e){return 1===e.type})),this.WXModules=e.filter((function(e){return 2===e.type}));var o=Object(a.c)(this.pcModules),i=Object(a.c)(this.WXModules);this.initCheckBox(o,this.modulesCheckbox,this.checkedModules,this.checkAll,this.isIndeterminate),this.initCheckBox(i,this.modulesCheckbox,this.checkedWXAllModules,this.checkAll,this.isIndeterminate),n.forEach((function(e){1===e.have&&t.defaultModules.push(e.id)}))},initCheckBox:function(e,t,n,a,r){var o=this;e.forEach((function(e){var i=e.id,l=e.parent_id;l&&t[l].push(i),1===e.have&&e.parent_id?(n[l].push(e.id),a[l]=n[l].length===t[l].length):1!==e.have||0!==l||e.items||(o.checkAll[i]=!0),l&&(r[l]=n[l].length>0&&n[l].length<t[l].length)}))},handleCheckAllChange:function(e,t){this.checkedModules[""+t]=e?this.modulesCheckbox[""+t]:[],this.isIndeterminate[""+t]=!1},handleCheckedModulesChange:function(e,t){var n=e.length;this.checkAll[""+t]=n===this.modulesCheckbox[""+t].length,this.isIndeterminate[""+t]=n>0&&n<this.modulesCheckbox[""+t].length},confirm:function(){this.confirmed=!0,this.$emit("getModules",this.checkedModules,this.checkAll)}}},i=(n("4d10"),n("2877")),l=Object(i.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(e.title))])]),n("div",[e._v("PC端")]),e._l(e.pcModules,(function(t){return n("div",{key:t.create_time},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id],disabled:e.disabled},on:{change:function(n){return e.handleCheckAllChange(n,t.id)}},model:{value:e.checkAll[t.id],callback:function(n){e.$set(e.checkAll,t.id,n)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))]),n("el-checkbox-group",{staticStyle:{padding:"0 20px"},attrs:{disabled:e.disabled},on:{change:function(n){return e.handleCheckedModulesChange(n,t.id)}},model:{value:e.checkedModules[t.id],callback:function(n){e.$set(e.checkedModules,t.id,n)},expression:"checkedModules[item.id]"}},e._l(t.items,(function(t){return n("el-checkbox",{key:t.create_time,attrs:{disabled:e.disabled,label:t.id}},[e._v(e._s(t.name))])})),1)],1)})),n("div",[e._v("微信端")]),e._l(e.WXModules,(function(t){return n("div",{key:t.create_time},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate[t.id],disabled:e.disabled},on:{change:function(n){return e.handleCheckAllChange(n,t.id)}},model:{value:e.checkAll[t.id],callback:function(n){e.$set(e.checkAll,t.id,n)},expression:"checkAll[item.id]"}},[e._v(e._s(t.name))])],1)})),n("div",{staticStyle:{textAlign:"center"}},[n("el-button",{attrs:{disabled:e.confirmed},on:{click:e.confirm}},[e._v("确定")])],1)],2)}),[],!1,null,"a3e51d62",null);t.a=l.exports},a1f1:function(e,t,n){"use strict";n.r(t);var a=n("a34a"),r=n.n(a),o=n("365c"),i=n("84b8"),l=n("333d"),s=n("575f"),c=n("4360");function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function d(e,t,n,a,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function i(e){d(o,a,r,i,l,"next",e)}function l(e){d(o,a,r,i,l,"throw",e)}i(void 0)}))}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h,f,b,g,k,v,y,_,x,w={components:{Pagination:l.a,ShowModules:i.a},data:function(){var e;return m(e={grade:c.a.getters.grade},"grade",3),m(e,"modulesDialogType","role"),m(e,"isEdit",!1),m(e,"newRoleDialogVisible",!1),m(e,"queryForm",{}),m(e,"roleForm",{canteens:[],rules:["12","13","14"]}),m(e,"companyOptions",[]),m(e,"canteenGroup",[]),m(e,"datatable",[]),m(e,"current_page",1),m(e,"total",0),m(e,"size",10),m(e,"modules",[]),m(e,"isConfirmRules",!1),e},created:function(){this.getCompanies(),this.fetchList()},computed:{companiesVisible:function(){return 3!==this.grade}},methods:{getCompanies:(x=p(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.get("http://canteen.tonglingok.com/api/v1/admin/companies",this.queryForm);case 2:"ok"===(t=e.sent).msg&&(this.companyOptions=Object(s.a)(t.data));case 4:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),fetchList:(_=p(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||1,e.next=3,o.a.get("http://canteen.tonglingok.com/api/v1/roles?page="+t+"&size="+this.size,this.queryForm);case 3:"ok"===(n=e.sent).msg&&(this.datatable=Array.from(n.data.data),this.current_page=n.data.current_page,this.total=n.data.total);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)}),getCanteenList:(y=p(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t||"",e.next=3,o.a.get("http://canteen.tonglingok.com/api/v1/company/consumptionLocation?company_id=".concat(n));case 3:return"ok"===(a=e.sent).msg&&(this.canteenGroup=Array.from(a.data.canteen)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)}),getCanteenModuls:(v=p(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.get("http://canteen.tonglingok.com/api/v1/modules/canteen/withoutSystem?company_id=".concat(t));case 2:return"ok"===(n=e.sent).msg&&(this.modules=Array.from(n.data)),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)}),openNewRoleDialog:function(){this.newRoleDialogVisible=!0},closeNewRoleDialog:function(){this.isEdit=!1,this.roleForm={},this.modules=[],this.newRoleDialogVisible=!1},selectCompany:(k=p(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.companyOptions.filter((function(e){return e.id===t})),this.roleForm.company=n[0].name,this.isConfirmRules=!1,e.next=5,this.getCanteenList(t);case 5:return e.next=7,this.getCanteenModuls(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)}),_confirm:(g=p(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isConfirmRules||this.$message.warning("请先确定角色模块"),t=[],n=[],t=this.roleForm.canteens?this.roleForm.canteens:[],console.log(t),t.forEach((function(e){n.push({c_id:e.id,name:e.name})})),this.roleForm.canteens=JSON.stringify(n),this.roleForm.rules=this.roleForm.rules.toString(),e.abrupt("return");case 13:e.sent,e.next=24;break;case 16:return e.next=18,o.a.post("http://canteen.tonglingok.com/api/v1/role/save",this.roleForm);case 18:if("ok"!==e.sent.msg){e.next=24;break}return this.$message.success("新增角色成功"),e.next=23,this.fetchList();case 23:this.newRoleDialogVisible=!1;case 24:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)}),_edit:(b=p(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isEdit=!0,this.roleForm=Object.assign({},t),n=t.id,e.next=5,this.getEditRole(n);case 5:"ok"===(a=e.sent).msg&&(this.modules=Array.from(a.data.modules)),this.newRoleDialogVisible=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)}),operateRoles:(f=p(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=1==(n=t.state)?2:1,e.next=4,o.a.post("http://canteen.tonglingok.com/api/v1/role/handel",{id:t.id,state:n});case 4:if("ok"!==e.sent.msg){e.next=9;break}return this.$message.success("修改成功"),e.next=9,this.fetchList();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)}),getRoleRules:function(e,t){console.log(e,t),this.isConfirmRules=!0;for(var n=Object(s.c)(this.modules),a=[],r=0,o=Object.entries(e);r<o.length;r++){var i=u(o[r],2),l=i[0],c=i[1];a.push(c)}(a=a.flat(1/0)).forEach((function(e){n.filter((function(t){t.id===e&&t.parent_id&&a.push(t.parent_id)}))}));for(var d=0,p=Object.entries(t);d<p.length;d++){var m=u(p[d],2);l=m[0];(c=m[1])&&a.push(Number(l))}a=Array.from(new Set(a));var h=[],f=Object(s.c)(this.modules);a.forEach((function(e){f.forEach((function(t){t.id===e&&h.push(t.c_m_id)}))})),this.roleForm.rules=h},getEditRole:(h=p(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.get("http://canteen.tonglingok.com/api/v1/role?id=".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})}},C=(n("6b4b"),n("2877")),F=Object(C.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"role-play"},[n("div",{staticClass:"nav-title"},[e._v("角色设置")]),n("el-divider"),n("div",{staticClass:"main"},[n("div",{staticClass:"main-header"},[n("el-form",{ref:"queryForm",attrs:{model:e.queryForm,inline:!0,"label-width":"60px"}},[e.companiesVisible?n("el-form-item",{attrs:{label:"公司",prop:"c_name"}},[n("el-select",{model:{value:e.queryForm.c_name,callback:function(t){e.$set(e.queryForm,"c_name",t)},expression:"queryForm.c_name"}},e._l(e.companyOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1):e._e(),n("el-form-item",{attrs:{label:"状态",prop:"state"}},[n("el-select",{model:{value:e.queryForm.state,callback:function(t){e.$set(e.queryForm,"state",t)},expression:"queryForm.state"}},[n("el-option",{attrs:{label:"全部",value:"3"}}),n("el-option",{attrs:{label:"正常",value:"1"}}),n("el-option",{attrs:{label:"停用",value:"2"}})],1)],1),n("el-form-item",{attrs:{label:"关键字",prop:"key"}},[n("el-input",{attrs:{placeholder:"请输入关键字"},model:{value:e.queryForm.key,callback:function(t){e.$set(e.queryForm,"key",t)},expression:"queryForm.key"}})],1),n("el-button",{on:{click:e.fetchList}},[e._v("查询")]),n("el-button",{on:{click:e.openNewRoleDialog}},[e._v("新增角色")])],1)],1),n("div",{staticClass:"main-content"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.datatable}},[n("el-table-column",{attrs:{label:"归属公司",prop:"company"}}),n("el-table-column",{attrs:{label:"角色名称",prop:"role"}}),n("el-table-column",{attrs:{label:"账号",prop:"account"}}),n("el-table-column",{attrs:{label:"可见饭堂"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.canteen.map((function(e){return e.canteen_name})).join(",")))])]}}])}),n("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:1===t.row.state?"success":"danger"}},[e._v(e._s(1===t.row.state?"正常":"停用"))])]}}])}),n("el-table-column",{attrs:{label:"备注",prop:"remark"}}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e.operateRoles(t.row)}}},[e._v(e._s(1===t.row.state?"停用":"启用"))]),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e._edit(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{type:"text",size:"mini"}},[e._v("删除")])],1)]}}])})],1),n("pagination",{attrs:{total:e.total,pageSize:e.size,currentPage:e.current_page},on:{pagination:e.fetchList}})],1)]),n("el-dialog",{attrs:{visible:e.newRoleDialogVisible,width:"60%",center:"",title:"新增角色"},on:{"update:visible":function(t){e.newRoleDialogVisible=t},close:e.closeNewRoleDialog}},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:6}},[n("el-form",{ref:"roleForm",attrs:{model:e.roleForm,"label-width":"70px","label-position":"left"}},[e.isEdit?e._e():n("el-form-item",{attrs:{label:"公司名称",prop:"c_id"}},[n("el-select",{attrs:{placeholder:"请输入公司",filterable:""},on:{change:e.selectCompany},model:{value:e.roleForm.c_id,callback:function(t){e.$set(e.roleForm,"c_id",t)},expression:"roleForm.c_id"}},e._l(e.companyOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.isEdit?e._e():n("el-form-item",{attrs:{label:"可见饭堂",prop:"canteen"}},[n("el-checkbox-group",{model:{value:e.roleForm.canteens,callback:function(t){e.$set(e.roleForm,"canteens",t)},expression:"roleForm.canteens"}},e._l(e.canteenGroup,(function(t){return n("el-checkbox",{key:t.id,staticClass:"canteenCheckbox",attrs:{label:t}},[e._v(e._s(t.name))])})),1)],1),e.isEdit?e._e():n("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[n("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.roleForm.phone,callback:function(t){e.$set(e.roleForm,"phone",t)},expression:"roleForm.phone"}})],1),n("el-form-item",{attrs:{label:"角色名称",prop:"role"}},[n("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.roleForm.role,callback:function(t){e.$set(e.roleForm,"role",t)},expression:"roleForm.role"}})],1),e.isEdit?e._e():n("el-form-item",{attrs:{label:"角色账号",prop:"account"}},[n("el-input",{attrs:{placeholder:"请输入账号"},model:{value:e.roleForm.account,callback:function(t){e.$set(e.roleForm,"account",t)},expression:"roleForm.account"}})],1),e.isEdit?e._e():n("el-form-item",{attrs:{label:"角色密码",prop:"passwd"}},[n("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:e.roleForm.passwd,callback:function(t){e.$set(e.roleForm,"passwd",t)},expression:"roleForm.passwd"}})],1),n("el-form-item",{attrs:{label:"角色说明",prop:"remark"}},[n("el-input",{attrs:{placeholder:"请输入角色说明...",type:"textarea",rows:2},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark",t)},expression:"roleForm.remark"}})],1)],1)],1),n("el-col",{attrs:{span:18}},[n("show-modules",{attrs:{modules:e.modules,isConfirm:e.isConfirmRules,disabled:!1},on:{getModules:function(t,n){return e.getRoleRules(t,n)}}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeNewRoleDialog}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e._confirm}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"6089550a",null);t.default=F.exports},c9ac:function(e,t,n){}}]);