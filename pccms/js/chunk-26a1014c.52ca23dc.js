(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-26a1014c"],{2404:function(t,e,a){},"2f0c":function(t,e,a){"use strict";var n=a("7361");a.n(n).a},"333d":function(t,e,a){"use strict";var n={name:"Pagination",props:{small:{type:Boolean,default:!1},total:{required:!0,type:Number},page:{type:Number,default:1},background:{type:Boolean,default:!0},layout:{type:String,default:"prev, pager, next"},pageSize:{type:Number,default:10}},computed:{currentPage:{get:function(){return this.page},set:function(t){this.$emit("update:page",t)}}},methods:{handleClickPage:function(t){this.$emit("pagination",t)}}},i=(a("2f0c"),a("2877")),o=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{small:t.small,background:t.background,total:t.total,layout:t.layout,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"current-change":t.handleClickPage}})],1)}),[],!1,null,null,null);e.a=o.exports},"5b48":function(t,e,a){},7361:function(t,e,a){},"76a6":function(t,e,a){"use strict";var n=a("5b48");a.n(n).a},"77d3":function(t,e,a){"use strict";a.r(e);var n=a("365c"),i={data:function(){return{formdata:{},rules:{},isOpen:this.visible}},watch:{visible:function(t){this.isOpen=t,this.formdata=Object.assign({},this.editFormdata)}},props:{visible:{type:Boolean},title:{type:String,required:!0},editFormdata:{type:Object},type:{type:String}},methods:{doClose:function(){this.$emit("close",!1)},handleClick:function(){console.log(this.GLOBAL_ROLE);var t=this.formdata;if("_add"===this.type)this.sendPostRequest("http://canteen.tonglingok.com/api/v1/material/save",t),this.$refs.addMaterialForm.resetFields();else{var e=t.id,a=t.name,n=t.price,i=t.unit;this.sendPostRequest("http://canteen.tonglingok.com/api/v1/material/update",{id:e,name:a,price:n,unit:i})}},sendPostRequest:function(t,e){var a=this;n.a.post(t,e).then((function(t){a.doClose(),a.sendMessage(t.msg),a.$emit("confirm",t.msg)})).catch((function(t){return console.log(t)}))},sendMessage:function(t){"ok"===t?this.$message({type:"success",message:"操作成功!"}):this.$message({type:"info",message:"操作失败"})}}},o=(a("972a"),a("2877")),s=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{ref:"materialDialog",staticClass:"materialDialog",attrs:{title:t.title,visible:t.isOpen,width:"25%"},on:{"update:visible":function(e){t.isOpen=e},close:t.doClose}},[a("el-form",{ref:"addMaterialForm",attrs:{rules:t.rules,model:t.formdata,"label-width":"80px",center:"",title:"新增材料"}},[a("el-form-item",{attrs:{label:"材料名称",prop:"name"}},[a("el-input",{model:{value:t.formdata.name,callback:function(e){t.$set(t.formdata,"name",e)},expression:"formdata.name"}})],1),a("el-form-item",{attrs:{label:"单价",prop:"price"}},[a("el-input",{model:{value:t.formdata.price,callback:function(e){t.$set(t.formdata,"price",e)},expression:"formdata.price"}})],1),a("el-form-item",{attrs:{label:"单位",prop:"unit"}},[a("el-input",{model:{value:t.formdata.unit,callback:function(e){t.$set(t.formdata,"unit",e)},expression:"formdata.unit"}})],1),a("div",{staticClass:"btn"},[a("el-button",{on:{click:t.doClose}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.handleClick(e)}}},[t._v("确定")])],1)],1)],1)}),[],!1,null,"8552d4f8",null).exports,c=a("333d"),l=a("4360"),r={data:function(){return{header:{token:l.a.getters.token},grade:l.a.getters.grade,company_id:"",companyList:[],canteen_id:"",canteenList:[],tableData:[],keyword:"",editType:"",dialogTitle:"",visible:!1,editFormdata:{},result:[],total:0,page:1,limit:1}},created:function(){this.companiesVisible?this.fetchCompanyList():this.fetchCanteenList(0)},computed:{companiesVisible:function(){return 3!==this.grade}},methods:{sendMessage:function(t){"ok"===t?this.$message({type:"success",message:"操作成功!"}):this.$message({type:"info",message:"操作失败"})},flatten:function(t){for(var e=0,a=t.length;e<a;e++)this.companyList.push({id:t[e].id,name:t[e].name}),void 0!==t[e].items&&this.flatten(t[e].items)},fetchCompanyList:function(){var t=this;n.a.get("http://canteen.tonglingok.com/api/v1/admin/companies").then((function(e){t.flatten(e.data);var a="";t.companyList.forEach((function(e,n){n<=t.companyList.length&&(a+=e.id+",")})),a=a.slice(0,-1),t.companyList.unshift({id:a,name:"全部"})})).catch((function(t){return console.log(err)}))},fetchCanteenList:function(t){var e=this;this.canteen_id="",this.canteenList=[],this.companiesVisible?"string"==typeof t&&t.indexOf(",")?this.canteenList.unshift({id:"",name:"全部"}):n.a.get("http://canteen.tonglingok.com/api/v1/canteens?company_id=".concat(t)).then((function(t){e.canteenList=Array.from(t.data)})).catch((function(t){return console.log(t)})):n.a.get("http://canteen.tonglingok.com/api/v1/managerCanteens").then((function(t){e.canteenList=Array.from(t.data)})).catch((function(t){return console.log(t)}))},fetchTableList:function(){var t=this;n.a.get("http://canteen.tonglingok.com/api/v1/materials?page=".concat(this.page,"&size=10&key=").concat(this.keyword,"&canteen_ids=").concat(this.canteen_id,"&company_ids=").concat(this.company_id)).then((function(e){t.tableData=e.data.data,t.total=e.data.total})).catch((function(t){return console.log(err)}))},handleClick:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.visible=!0,this.dialogTitle=a,this.editType=e,Object.assign(this.editFormdata,{},t)},_delete:function(t){var e=this;this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$axios.post("http://canteen.tonglingok.com/api/v1/material/handel",{id:t.id}).then((function(t){e.fetchTableList(),"ok"==t.data.msg?e.$message({type:"success",message:"删除成功!"}):e.$message({type:"info",message:"操作失败"})})).catch((function(t){return console.log(t)}))}))},getList:function(t){this.page=t,this.fetchTableList()},closeDialog:function(t){this.visible=t,this.editFormdata={}},deriveData:function(){var t=this;n.a.get("http://canteen.tonglingok.com/api/v1/material/export?key=".concat(this.keyword,"&canteen_ids=").concat(this.canteen_id,"&company_ids=").concat(this.company_id)).then((function(e){if(t.tableData.length>0){var a=document.createElement("a");a.download="材料价格明细",a.href=e.data.url,a.click()}})).catch((function(t){return console.log(err)}))},confirmUpdate:function(t){"ok"===t&&this.fetchTableList()},handleSuccess:function(t,e,a){this.sendMessage(t.msg),this.fetchTableList()}},components:{HandleDialog:s,Pagination:c.a}},d=(a("76a6"),Object(o.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"details"},[a("div",{staticClass:"nav-title"},[t._v("材料价格明细")]),a("el-divider"),a("div",{staticClass:"main"},[a("div",{staticClass:"main-header"},[t.companiesVisible?a("span",{staticClass:"content-header"},[t._v("公司：")]):t._e(),t.companiesVisible?a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},on:{change:function(e){return t.fetchCanteenList(t.company_id)}},model:{value:t.company_id,callback:function(e){t.company_id=e},expression:"company_id"}},t._l(t.companyList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._e(),a("span",{staticClass:"content-header"},[t._v("消费地点：")]),a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},model:{value:t.canteen_id,callback:function(e){t.canteen_id=e},expression:"canteen_id"}},t._l(t.canteenList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),a("el-input",{staticStyle:{width:"180px",margin:"0 15px"},attrs:{placeholder:"请输入内容","prefix-icon":"el-icon-search",clearable:!0},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),a("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"primary",plain:""},on:{click:t.fetchTableList}},[t._v("查询")]),a("el-button",{attrs:{type:"primary"},on:{click:t.deriveData}},[t._v("导出")]),a("el-upload",{ref:"upload",staticClass:"upload-excel",attrs:{limit:t.limit,headers:t.header,"show-file-list":!1,accept:".xls, .xlsx",action:"http://canteen.tonglingok.com/api/v1/material/upload","on-success":t.handleSuccess,data:{c_id:t.canteen_id},name:"materials"}},[a("el-button",{attrs:{type:"primary"}},[t._v("批量导入")])],1),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleClick({c_id:t.canteen_id},"_add","新增材料")}}},[t._v("添加")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],staticClass:"total"},[a("span",[t._v("\n        共有\n        "),a("strong",[t._v(t._s(t.total))]),t._v(" 条记录\n      ")])]),a("div",{staticClass:"main-content"},[a("el-table",{staticStyle:{width:"100%","font-size":"14px"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"id",label:"序号",width:"200px"}}),a("el-table-column",{attrs:{prop:"name",label:"材料名称"}}),a("el-table-column",{attrs:{label:"单价/元"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.price)+"元/kg")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.handleClick(e.row,"_edit","编辑材料")}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t._delete(e.row)}}},[t._v("Delete")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>10,expression:"total > 10"}],attrs:{total:t.total,page:t.page},on:{"update:page":function(e){t.page=e},pagination:t.getList}})],1)]),a("handle-dialog",{ref:"materialDialog",attrs:{visible:t.visible,type:t.editType,editFormdata:t.editFormdata,title:t.dialogTitle},on:{close:t.closeDialog,confirm:t.confirmUpdate}})],1)}),[],!1,null,"70f40d66",null));e.default=d.exports},"972a":function(t,e,a){"use strict";var n=a("2404");a.n(n).a}}]);