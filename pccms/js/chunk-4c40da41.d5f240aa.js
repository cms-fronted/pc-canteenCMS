(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4c40da41"],{"7b6e":function(e,t,s){},9924:function(e,t,s){"use strict";var o=s("7b6e");s.n(o).a},d89e:function(e,t,s){"use strict";s.r(t);var o=s("a34a"),l=s.n(o),a=s("365c"),n=s("575f");function i(e,t,s,o,l,a,n){try{var i=e[a](n),r=i.value}catch(e){return void s(e)}i.done?t(r):Promise.resolve(r).then(o,l)}function r(e){return function(){var t=this,s=arguments;return new Promise((function(o,l){var a=e.apply(t,s);function n(e){i(a,o,l,n,r,"next",e)}function r(e){i(a,o,l,n,r,"throw",e)}n(void 0)}))}}var u,d,c,m,p,f={data:function(){return{title:"默认设置模块",systemType:2,noParentId:!0,typeDisabled:!1,modulesDialogTitle:"新增模块",changeDefaultStatus:!1,modulesVisible:!1,editModuleVisible:!1,modulesBelong:"",modulesForm:{name:"",url:"",icon:"",type:1,default:1,parent_id:""},editModuleForm:{},systemModules:[],s_modules:[],canteenModules:[],c_modules:[],modulesData:[],shopModules:[],p_modules:[],defaultProps:{label:"name",children:"items"},timer:null}},created:function(){this.renderModules()},watch:{changeDefaultStatus:function(e){this.title=e?"更改默认模块":"默认设置模块"}},methods:{openModuleDialog:function(e,t,s){var o=t||{};o.id?(this.modulesForm.parent_id=t.id,this.modulesForm.type=o.type,this.typeDisabled=!0):(this.modulesForm.parent_id=0,this.typeDisabled=!1),this.modulesVisible=!0},closeModuleDialog:function(){this.modulesVisible=!1,this.systemType=1,this.$refs.modulesForm.resetFields()},openEditModuleDialog:function(e,t){this.editModuleVisible=!0,this.editModuleForm=Object.assign({},{name:e.name,id:e.id,type:t})},closeEditModuleDialog:function(){this.editModuleVisible=!1,this.editModuleForm={}},checkChange:(p=r(l.a.mark((function e(t,s,o,n){var i,r,u=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={},r=s?1:2,t.items&&t.items.forEach((function(e){1===e.default&&(r=1)})),(i=Object.assign({},{type:n,modules:[{id:t.id,default:r}]})).modules=JSON.stringify(i.modules),e.next=8,a.a.post("http://canteen.tonglingok.com/api/v1/module/default/handel",i);case 8:"ok"===e.sent.msg&&(t.items||(this.timer=setTimeout((function(){u.$message.success("修改成功")}),300)));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,s,o){return p.apply(this,arguments)}),changeDefault:function(){this.changeDefaultStatus=!this.changeDefaultStatus,this.changeDefaultStatus||this.renderModules()},submitModulesForm:(m=r(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.systemType,e.next=4,a.a.post("http://canteen.tonglingok.com/api/v1/module/system/canteen/save",this.modulesForm);case 4:"ok"===e.sent.msg&&(this.closeModuleDialog(),this.renderModules(),this.$message.success("模块添加成功"));case 6:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)}),submitEditModulesForm:(c=r(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.post("http://canteen.tonglingok.com/api/v1/module/update",this.editModuleForm);case 2:"ok"===e.sent.msg&&(this.closeEditModuleDialog(),this.$message.success("修改成功"),this.renderModules());case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),renderModules:(d=r(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.a.get("http://canteen.tonglingok.com/api/v1/modules?type=2");case 3:"ok"===(t=e.sent).msg&&(console.log(t),this.canteenModules=Array.from(t.data),this.modulesData=Object(n.c)(t.data),this.c_modules=Object(n.a)(t.data),this.handleModuleData(this.c_modules,"canteenTree")),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return d.apply(this,arguments)}),handleModuleData:function(e,t){var s=[];e.forEach((function(e){1==e.default&&0===e.p_id&&s.push(e.id),1==e.default&&0!==e.p_id&&s.push(e.id),2===e.default&&0!==e.p_id&&-1!==s.indexOf(e.p_id)&&s.splice(s.indexOf(e.p_id),1)})),this.$refs[t].setCheckedKeys(s)},changeModulesState:(u=r(l.a.mark((function e(t){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(s={}).id=t.id,s.state=1===t.state?2:1,console.log(s),e.next=6,a.a.post("http://canteen.tonglingok.com/api/v1/module/system/handel",s);case 6:"ok"===e.sent.msg&&(this.$message.success("操作成功!"),this.renderModules());case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})}},h=(s("9924"),s("2877")),b=Object(h.a)(f,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modules"},[s("div",{staticClass:"nav-title"},[e._v("模块管理")]),s("el-divider"),s("div",{staticClass:"main"},[s("div",{staticClass:"main-header"},[s("el-button",{attrs:{type:"primary"},on:{click:e.changeDefault}},[e._v("\n        "+e._s(e.changeDefaultStatus?"完成默认设置":"更改默认设置")+"\n      ")]),s("el-button",{attrs:{type:"primary"},on:{click:e.openModuleDialog}},[e._v("增加模块")]),s("el-button",{attrs:{type:"primary"}},[e._v("模块设置")])],1),s("div",{staticClass:"main-content"},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v(e._s(e.title))])]),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"modules-tree-container"},[s("div",{staticClass:"block"},[s("p",[e._v("饭堂功能模块")]),s("el-tree",{ref:"canteenTree",attrs:{data:e.canteenModules,"node-key":"id",props:e.defaultProps,"show-checkbox":e.changeDefaultStatus,"default-expand-all":""},on:{"check-change":function(t,s,o){return e.checkChange(t,s,o,2)}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,l=t.data;return s("span",{staticClass:"modules-tree-node"},[s("span",[e._v("\n                      "+e._s(1===l.type?"PC端":"移动端")+"——"+e._s(o.label)+"\n                    ")]),s("span",{staticClass:"btns-text"},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.openEditModuleDialog(l,2)}}},[e._v("编辑")]),1===l.type?s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.openModuleDialog(o,l)}}},[e._v("新增")]):e._e()],1)])}}])})],1)])]),s("el-col",{attrs:{span:16}},[s("el-table",{attrs:{data:e.modulesData,border:""}},[s("el-table-column",{attrs:{label:"模块名称",prop:"name"}}),s("el-table-column",{attrs:{label:"模块类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(1===t.row.type?"PC端":"移动端"))])]}}])}),s("el-table-column",{attrs:{label:"是否默认"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(1===t.row.default?"默认":"非默认"))])]}}])}),s("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(1===t.row.state?"启用":"停用"))])]}}])}),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"small"},on:{click:function(s){return e.changeModulesState(t.row)}}},[e._v(e._s(1===t.row.state?"停用":"启用"))])]}}])})],1)],1)],1)],1)],1)]),s("el-dialog",{attrs:{visible:e.modulesVisible,title:e.modulesDialogTitle,center:"",width:"30%"},on:{"update:visible":function(t){e.modulesVisible=t},close:e.closeModuleDialog}},[s("el-form",{ref:"modulesForm",attrs:{model:e.modulesForm,"label-width":"80px","label-position":"right"}},[e._e(),s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{model:{value:e.modulesForm.name,callback:function(t){e.$set(e.modulesForm,"name",t)},expression:"modulesForm.name"}})],1),s("el-form-item",{attrs:{label:"模块路由",prop:"url"}},[s("el-input",{model:{value:e.modulesForm.url,callback:function(t){e.$set(e.modulesForm,"url",t)},expression:"modulesForm.url"}})],1),s("el-form-item",{attrs:{label:"icon地址",prop:"icon"}},[s("el-input",{model:{value:e.modulesForm.icon,callback:function(t){e.$set(e.modulesForm,"icon",t)},expression:"modulesForm.icon"}})],1),s("el-form-item",{attrs:{label:"模块类型",prop:"type"}},[s("el-radio-group",{attrs:{disabled:e.typeDisabled},model:{value:e.modulesForm.type,callback:function(t){e.$set(e.modulesForm,"type",t)},expression:"modulesForm.type"}},[s("el-radio",{attrs:{label:1}},[e._v("pc端")]),s("el-radio",{attrs:{label:2}},[e._v("手机端")])],1)],1),s("el-form-item",{attrs:{label:"默认模块",prop:"default"}},[s("el-radio-group",{model:{value:e.modulesForm.default,callback:function(t){e.$set(e.modulesForm,"default",t)},expression:"modulesForm.default"}},[s("el-radio",{attrs:{label:1}},[e._v("是")]),s("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeModuleDialog}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.submitModulesForm}},[e._v("确定")])],1)],1),s("el-dialog",{attrs:{visible:e.editModuleVisible,title:"编辑模块",center:"",width:"20%"},on:{"update:visible":function(t){e.editModuleVisible=t},close:e.closeEditModuleDialog}},[s("el-form",{ref:"editModuleForm",attrs:{model:e.editModuleForm}},[s("el-form-item",{attrs:{label:"名称","label-width":"40px"}},[s("el-input",{model:{value:e.editModuleForm.name,callback:function(t){e.$set(e.editModuleForm,"name",t)},expression:"editModuleForm.name"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeEditModuleDialog}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.submitEditModulesForm}},[e._v("确定")])],1)],1)],1)}),[],!1,null,"4a628bac",null);t.default=b.exports}}]);